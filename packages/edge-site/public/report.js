var EventType,IncrementalSource,MouseInteractions,MediaInteractions,ReplayerEvents;!function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin"}(EventType||(EventType={})),function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag"}(IncrementalSource||(IncrementalSource={})),function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd"}(MouseInteractions||(MouseInteractions={})),function(e){e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked"}(MediaInteractions||(MediaInteractions={})),function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back"}(ReplayerEvents||(ReplayerEvents={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var __assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},NodeType;function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}function isElement(e){return e.nodeType===e.ELEMENT_NODE}function isShadowRoot(e){var t,n=null===(t=e)||void 0===t?void 0:t.host;return Boolean(n&&n.shadowRoot&&n.shadowRoot===e)}function maskInputValue(e){var t=e.maskInputOptions,n=e.tagName,r=e.type,o=e.value,i=e.maskInputFn,s=o||"";return(t[n.toLowerCase()]||t[r])&&(s=i?i(s):"*".repeat(s.length)),s}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(NodeType||(NodeType={}));var _id=1,tagNameRegex=RegExp("[^a-z0-9-_:]"),IGNORED_NODE=-2;function genId(){return _id++}function getValidTagName(e){if(e instanceof HTMLFormElement)return"form";var t=e.tagName.toLowerCase().trim();return tagNameRegex.test(t)?"div":t}function getCssRulesString(e){try{var t=e.rules||e.cssRules;return t?Array.from(t).map(getCssRuleString).join(""):null}catch(e){return null}}function getCssRuleString(e){return isCSSImportRule(e)?getCssRulesString(e.styleSheet)||"":e.cssText}function isCSSImportRule(e){return"styleSheet"in e}function extractOrigin(e){return(e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0]).split("?")[0]}var URL_IN_CSS_REF=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,RELATIVE_PATH=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,DATA_URI=/^(data:)([^,]*),(.*)/i;function absoluteToStylesheet(e,t){return(e||"").replace(URL_IN_CSS_REF,(function(e,n,r,o,i,s){var a=r||i||s,u=n||o||"";if(!a)return e;if(!RELATIVE_PATH.test(a))return"url("+u+a+u+")";if(DATA_URI.test(a))return"url("+u+a+u+")";if("/"===a[0])return"url("+u+(extractOrigin(t)+a)+u+")";var l=t.split("/"),c=a.split("/");l.pop();for(var f=0,d=c;f<d.length;f++){var p=d[f];"."!==p&&(".."===p?l.pop():l.push(p))}return"url("+u+l.join("/")+u+")"}))}var SRCSET_NOT_SPACES=/^[^ \t\n\r\u000c]+/,SRCSET_COMMAS_OR_SPACES=/^[, \t\n\r\u000c]+/;function getAbsoluteSrcsetString(e,t){if(""===t.trim())return t;var n=0;function r(e){var r,o=e.exec(t.substring(n));return o?(r=o[0],n+=r.length,r):""}for(var o=[];r(SRCSET_COMMAS_OR_SPACES),!(n>=t.length);){var i=r(SRCSET_NOT_SPACES);if(","===i.slice(-1))i=absoluteToDoc(e,i.substring(0,i.length-1)),o.push(i);else{var s="";i=absoluteToDoc(e,i);for(var a=!1;;){var u=t.charAt(n);if(""===u){o.push((i+s).trim());break}if(a)")"===u&&(a=!1);else{if(","===u){n+=1,o.push((i+s).trim());break}"("===u&&(a=!0)}s+=u,n+=1}}}return o.join(", ")}function absoluteToDoc(e,t){if(!t||""===t.trim())return t;var n=e.createElement("a");return n.href=t,n.href}function isSVGElement(e){return"svg"===e.tagName||e instanceof SVGElement}function getHref(){var e=document.createElement("a");return e.href="",e.href}function transformAttribute(e,t,n,r){return"src"===n||("href"===n||"xlink:href"===n)&&r?absoluteToDoc(e,r):"background"!==n||!r||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===n&&r?getAbsoluteSrcsetString(e,r):"style"===n&&r?absoluteToStylesheet(r,getHref()):r:absoluteToDoc(e,r)}function _isBlockedElement(e,t,n){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var r=0;r<e.classList.length;r++){var o=e.classList[r];if(t.test(o))return!0}return!!n&&e.matches(n)}function needMaskingText(e,t,n){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){if("string"==typeof t){if(e.classList.contains(t))return!0}else e.classList.forEach((function(e){if(t.test(e))return!0}));return!(!n||!e.matches(n))||needMaskingText(e.parentNode,t,n)}return e.nodeType,e.TEXT_NODE,needMaskingText(e.parentNode,t,n)}function onceIframeLoaded(e,t,n){var r=e.contentWindow;if(r){var o,i=!1;try{o=r.document.readyState}catch(e){return}if("complete"===o){var s="about:blank";r.location.href===s&&e.src!==s&&""!==e.src?e.addEventListener("load",t):setTimeout(t,0)}else{var a=setTimeout((function(){i||(t(),i=!0)}),n);e.addEventListener("load",(function(){clearTimeout(a),i=!0,t()}))}}}function serializeNode(e,t){var n,r=t.doc,o=t.blockClass,i=t.blockSelector,s=t.maskTextClass,a=t.maskTextSelector,u=t.inlineStylesheet,l=t.maskInputOptions,c=void 0===l?{}:l,f=t.maskTextFn,d=t.maskInputFn,p=t.recordCanvas,h=t.keepIframeSrcFn;if(r.__sn){var m=r.__sn.id;n=1===m?void 0:m}switch(e.nodeType){case e.DOCUMENT_NODE:return{type:NodeType.Document,childNodes:[],rootId:n};case e.DOCUMENT_TYPE_NODE:return{type:NodeType.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:n};case e.ELEMENT_NODE:for(var v=_isBlockedElement(e,o,i),y=getValidTagName(e),g={},b=0,w=Array.from(e.attributes);b<w.length;b++){var S=w[b],k=S.name,E=S.value;g[k]=transformAttribute(r,y,k,E)}if("link"===y&&u){var _,O=Array.from(r.styleSheets).find((function(t){return t.href===e.href}));(_=getCssRulesString(O))&&(delete g.rel,delete g.href,g._cssText=absoluteToStylesheet(_,O.href))}if("style"===y&&e.sheet&&!(e.innerText||e.textContent||"").trim().length)(_=getCssRulesString(e.sheet))&&(g._cssText=absoluteToStylesheet(_,getHref()));if("input"===y||"textarea"===y||"select"===y){E=e.value;"radio"!==g.type&&"checkbox"!==g.type&&"submit"!==g.type&&"button"!==g.type&&E?g.value=maskInputValue({type:g.type,tagName:y,value:E,maskInputOptions:c,maskInputFn:d}):e.checked&&(g.checked=e.checked)}if("option"===y){var I=e.parentElement;g.value===I.value&&(g.selected=e.selected)}if("canvas"===y&&p&&(g.rr_dataURL=e.toDataURL()),"audio"!==y&&"video"!==y||(g.rr_mediaState=e.paused?"paused":"played",g.rr_mediaCurrentTime=e.currentTime),e.scrollLeft&&(g.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(g.rr_scrollTop=e.scrollTop),v){var C=e.getBoundingClientRect(),R=C.width,T=C.height;g={class:g.class,rr_width:R+"px",rr_height:T+"px"}}return"iframe"!==y||h(g.src)||delete g.src,{type:NodeType.Element,tagName:y,attributes:g,childNodes:[],isSVG:isSVGElement(e)||void 0,needBlock:v,rootId:n};case e.TEXT_NODE:var x=e.parentNode&&e.parentNode.tagName,$=e.textContent,N="STYLE"===x||void 0,M="SCRIPT"===x||void 0;return N&&$&&($=absoluteToStylesheet($,getHref())),M&&($="SCRIPT_PLACEHOLDER"),!N&&!M&&needMaskingText(e,s,a)&&$&&($=f?f($):$.replace(/[\S]/g,"*")),{type:NodeType.Text,textContent:$||"",isStyle:N,rootId:n};case e.CDATA_SECTION_NODE:return{type:NodeType.CDATA,textContent:"",rootId:n};case e.COMMENT_NODE:return{type:NodeType.Comment,textContent:e.textContent||"",rootId:n};default:return!1}}function lowerIfExists(e){return void 0===e?"":e.toLowerCase()}function slimDOMExcluded(e,t){if(t.comment&&e.type===NodeType.Comment)return!0;if(e.type===NodeType.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&"preload"===e.attributes.rel&&"script"===e.attributes.as||"link"===e.tagName&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&e.attributes.href.endsWith(".js")))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(lowerIfExists(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===lowerIfExists(e.attributes.name)||"icon"===lowerIfExists(e.attributes.rel)||"apple-touch-icon"===lowerIfExists(e.attributes.rel)||"shortcut icon"===lowerIfExists(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&lowerIfExists(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(lowerIfExists(e.attributes.property).match(/^(og|twitter|fb):/)||lowerIfExists(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===lowerIfExists(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===lowerIfExists(e.attributes.name)||"googlebot"===lowerIfExists(e.attributes.name)||"bingbot"===lowerIfExists(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===lowerIfExists(e.attributes.name)||"generator"===lowerIfExists(e.attributes.name)||"framework"===lowerIfExists(e.attributes.name)||"publisher"===lowerIfExists(e.attributes.name)||"progid"===lowerIfExists(e.attributes.name)||lowerIfExists(e.attributes.property).match(/^article:/)||lowerIfExists(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===lowerIfExists(e.attributes.name)||"yandex-verification"===lowerIfExists(e.attributes.name)||"csrf-token"===lowerIfExists(e.attributes.name)||"p:domain_verify"===lowerIfExists(e.attributes.name)||"verify-v1"===lowerIfExists(e.attributes.name)||"verification"===lowerIfExists(e.attributes.name)||"shopify-checkout-api-token"===lowerIfExists(e.attributes.name)))return!0}}return!1}function serializeNodeWithId(e,t){var n,r=t.doc,o=t.map,i=t.blockClass,s=t.blockSelector,a=t.maskTextClass,u=t.maskTextSelector,l=t.skipChild,c=void 0!==l&&l,f=t.inlineStylesheet,d=void 0===f||f,p=t.maskInputOptions,h=void 0===p?{}:p,m=t.maskTextFn,v=t.maskInputFn,y=t.slimDOMOptions,g=t.recordCanvas,b=void 0!==g&&g,w=t.onSerialize,S=t.onIframeLoad,k=t.iframeLoadTimeout,E=void 0===k?5e3:k,_=t.keepIframeSrcFn,O=void 0===_?function(){return!1}:_,I=t.preserveWhiteSpace,C=void 0===I||I,R=serializeNode(e,{doc:r,blockClass:i,blockSelector:s,maskTextClass:a,maskTextSelector:u,inlineStylesheet:d,maskInputOptions:h,maskTextFn:m,maskInputFn:v,recordCanvas:b,keepIframeSrcFn:O});if(!R)return console.warn(e,"not serialized"),null;n="__sn"in e?e.__sn.id:slimDOMExcluded(R,y)||!C&&R.type===NodeType.Text&&!R.isStyle&&!R.textContent.replace(/^\s+|\s+$/gm,"").length?IGNORED_NODE:genId();var T=Object.assign(R,{id:n});if(e.__sn=T,n===IGNORED_NODE)return null;o[n]=e,w&&w(e);var x=!c;if(T.type===NodeType.Element&&(x=x&&!T.needBlock,delete T.needBlock),(T.type===NodeType.Document||T.type===NodeType.Element)&&x){y.headWhitespace&&R.type===NodeType.Element&&"head"===R.tagName&&(C=!1);for(var $={doc:r,map:o,blockClass:i,blockSelector:s,maskTextClass:a,maskTextSelector:u,skipChild:c,inlineStylesheet:d,maskInputOptions:h,maskTextFn:m,maskInputFn:v,slimDOMOptions:y,recordCanvas:b,preserveWhiteSpace:C,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:E,keepIframeSrcFn:O},N=0,M=Array.from(e.childNodes);N<M.length;N++){(D=serializeNodeWithId(M[N],$))&&T.childNodes.push(D)}if(isElement(e)&&e.shadowRoot){T.isShadowHost=!0;for(var L=0,B=Array.from(e.shadowRoot.childNodes);L<B.length;L++){var D;(D=serializeNodeWithId(B[L],$))&&(D.isShadow=!0,T.childNodes.push(D))}}}return e.parentNode&&isShadowRoot(e.parentNode)&&(T.isShadow=!0),T.type===NodeType.Element&&"iframe"===T.tagName&&onceIframeLoaded(e,(function(){var t=e.contentDocument;if(t&&S){var n=serializeNodeWithId(t,{doc:t,map:o,blockClass:i,blockSelector:s,maskTextClass:a,maskTextSelector:u,skipChild:!1,inlineStylesheet:d,maskInputOptions:h,maskTextFn:m,maskInputFn:v,slimDOMOptions:y,recordCanvas:b,preserveWhiteSpace:C,onSerialize:w,onIframeLoad:S,iframeLoadTimeout:E,keepIframeSrcFn:O});n&&S(e,n)}}),E),T}function snapshot(e,t){var n=t||{},r=n.blockClass,o=void 0===r?"rr-block":r,i=n.blockSelector,s=void 0===i?null:i,a=n.maskTextClass,u=void 0===a?"rr-mask":a,l=n.maskTextSelector,c=void 0===l?null:l,f=n.inlineStylesheet,d=void 0===f||f,p=n.recordCanvas,h=void 0!==p&&p,m=n.maskAllInputs,v=void 0!==m&&m,y=n.maskTextFn,g=n.maskInputFn,b=n.slimDOM,w=void 0!==b&&b,S=n.preserveWhiteSpace,k=n.onSerialize,E=n.onIframeLoad,_=n.iframeLoadTimeout,O=n.keepIframeSrcFn,I={};return[serializeNodeWithId(e,{doc:e,map:I,blockClass:o,blockSelector:s,maskTextClass:u,maskTextSelector:c,skipChild:!1,inlineStylesheet:d,maskInputOptions:!0===v?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===v?{password:!0}:v,maskTextFn:y,maskInputFn:g,slimDOMOptions:!0===w||"all"===w?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===w,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===w?{}:w,recordCanvas:h,preserveWhiteSpace:S,onSerialize:k,onIframeLoad:E,iframeLoadTimeout:_,keepIframeSrcFn:void 0===O?function(){return!1}:O}),I]}function on(e,t,n){void 0===n&&(n=document);var r={capture:!0,passive:!0};return n.addEventListener(e,t,r),function(){return n.removeEventListener(e,t,r)}}function createMirror(){return{map:{},getId:function(e){return e.__sn?e.__sn.id:-1},getNode:function(e){return this.map[e]||null},removeNodeFromMap:function(e){var t=this,n=e.__sn&&e.__sn.id;delete this.map[n],e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},has:function(e){return this.map.hasOwnProperty(e)},reset:function(){this.map={}}}}var DEPARTED_MIRROR_ACCESS_WARNING="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.",_mirror={map:{},getId:function(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),-1},getNode:function(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),null},removeNodeFromMap:function(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)},has:function(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),!1},reset:function(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)}};function throttle(e,t,n){void 0===n&&(n={});var r=null,o=0;return function(i){var s=Date.now();o||!1!==n.leading||(o=s);var a=t-(s-o),u=this,l=arguments;a<=0||a>t?(r&&(window.clearTimeout(r),r=null),o=s,e.apply(u,l)):r||!1===n.trailing||(r=window.setTimeout((function(){o=!1===n.leading?0:Date.now(),r=null,e.apply(u,l)}),a))}}function hookSetter(e,t,n,r,o){void 0===o&&(o=window);var i=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,r?n:{set:function(e){var t=this;setTimeout((function(){n.set.call(t,e)}),0),i&&i.set&&i.set.call(this,e)}}),function(){return hookSetter(e,t,i||{},!0)}}function patch(e,t,n){try{if(!(t in e))return function(){};var r=e[t],o=n(r);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),e[t]=o,function(){e[t]=r}}catch(e){return function(){}}}function getWindowHeight(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function getWindowWidth(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function isBlocked(e,t){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){var n=!1;return"string"==typeof t?n=e.classList.contains(t):e.classList.forEach((function(e){t.test(e)&&(n=!0)})),n||isBlocked(e.parentNode,t)}return e.nodeType,e.TEXT_NODE,isBlocked(e.parentNode,t)}function isIgnored(e){return"__sn"in e&&e.__sn.id===IGNORED_NODE}function isAncestorRemoved(e,t){if(isShadowRoot(e))return!1;var n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||isAncestorRemoved(e.parentNode,t))}function isTouchEvent(e){return Boolean(e.changedTouches)}function polyfill(e){void 0===e&&(e=window),"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(e){if(!(0 in arguments))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}function isIframeINode(e){return"__sn"in e&&(e.__sn.type===NodeType.Element&&"iframe"===e.__sn.tagName)}function hasShadowRoot(e){var t;return Boolean(null===(t=e)||void 0===t?void 0:t.shadowRoot)}function isNodeInLinkedList(e){return"__ln"in e}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(_mirror=new Proxy(_mirror,{get:function(e,t,n){return"map"===t&&console.error(DEPARTED_MIRROR_ACCESS_WARNING),Reflect.get(e,t,n)}}));var DoubleLinkedList=function(){function e(){this.length=0,this.head=null}return e.prototype.get=function(e){if(e>=this.length)throw new Error("Position outside of list range");for(var t=this.head,n=0;n<e;n++)t=(null==t?void 0:t.next)||null;return t},e.prototype.addNode=function(e){var t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&isNodeInLinkedList(e.previousSibling)){var n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&isNodeInLinkedList(e.nextSibling)&&e.nextSibling.__ln.previous){n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;this.length++},e.prototype.removeNode=function(e){var t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)},e}(),moveKey=function(e,t){return e+"@"+t};function isINode(e){return"__sn"in e}var MutationBuffer=function(){function e(){var e=this;this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=function(t){t.forEach(e.processMutation),e.emit()},this.emit=function(){var t,n,r,o;if(!e.frozen&&!e.locked){for(var i=[],s=new DoubleLinkedList,a=function(t){for(var n=t,r=IGNORED_NODE;r===IGNORED_NODE;)r=(n=n&&n.nextSibling)&&e.mirror.getId(n);return-1===r&&isBlocked(t.nextSibling,e.blockClass)&&(r=null),r},u=function(t){var n,r=t.getRootNode?null===(n=t.getRootNode())||void 0===n?void 0:n.host:null,o=!e.doc.contains(t)&&!e.doc.contains(r);if(t.parentNode&&!o){var u=isShadowRoot(t.parentNode)?e.mirror.getId(r):e.mirror.getId(t.parentNode),l=a(t);if(-1===u||-1===l)return s.addNode(t);var c=serializeNodeWithId(t,{doc:e.doc,map:e.mirror.map,blockClass:e.blockClass,blockSelector:e.blockSelector,maskTextClass:e.maskTextClass,maskTextSelector:e.maskTextSelector,skipChild:!0,inlineStylesheet:e.inlineStylesheet,maskInputOptions:e.maskInputOptions,maskTextFn:e.maskTextFn,maskInputFn:e.maskInputFn,slimDOMOptions:e.slimDOMOptions,recordCanvas:e.recordCanvas,onSerialize:function(n){isIframeINode(n)&&e.iframeManager.addIframe(n),hasShadowRoot(t)&&e.shadowDomManager.addShadowRoot(t.shadowRoot,document)},onIframeLoad:function(t,n){e.iframeManager.attachIframe(t,n)}});c&&i.push({parentId:u,nextId:l,node:c})}};e.mapRemoves.length;)e.mirror.removeNodeFromMap(e.mapRemoves.shift());try{for(var l=__values(e.movedSet),c=l.next();!c.done;c=l.next()){var f=c.value;isParentRemoved(e.removes,f,e.mirror)&&!e.movedSet.has(f.parentNode)||u(f)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}try{for(var d=__values(e.addedSet),p=d.next();!p.done;p=d.next()){f=p.value;isAncestorInSet(e.droppedSet,f)||isParentRemoved(e.removes,f,e.mirror)?isAncestorInSet(e.movedSet,f)?u(f):e.droppedSet.add(f):u(f)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}for(var h=null;s.length;){var m=null;if(h){var v=e.mirror.getId(h.value.parentNode),y=a(h.value);-1!==v&&-1!==y&&(m=h)}if(!m)for(var g=s.length-1;g>=0;g--){var b=s.get(g);v=e.mirror.getId(b.value.parentNode),y=a(b.value);if(-1!==v&&-1!==y){m=b;break}}if(!m){for(;s.head;)s.removeNode(s.head.value);break}h=m.previous,s.removeNode(m.value),u(m.value)}var w={texts:e.texts.map((function(t){return{id:e.mirror.getId(t.node),value:t.value}})).filter((function(t){return e.mirror.has(t.id)})),attributes:e.attributes.map((function(t){return{id:e.mirror.getId(t.node),attributes:t.attributes}})).filter((function(t){return e.mirror.has(t.id)})),removes:e.removes,adds:i};(w.texts.length||w.attributes.length||w.removes.length||w.adds.length)&&(e.texts=[],e.attributes=[],e.removes=[],e.addedSet=new Set,e.movedSet=new Set,e.droppedSet=new Set,e.movedMap={},e.emissionCallback(w))}},this.processMutation=function(t){if(!isIgnored(t.target))switch(t.type){case"characterData":var n=t.target.textContent;isBlocked(t.target,e.blockClass)||n===t.oldValue||e.texts.push({value:needMaskingText(t.target,e.maskTextClass,e.maskTextSelector)&&n?e.maskTextFn?e.maskTextFn(n):n.replace(/[\S]/g,"*"):n,node:t.target});break;case"attributes":var r=t.target;n=t.target.getAttribute(t.attributeName);if("value"===t.attributeName&&(n=maskInputValue({maskInputOptions:e.maskInputOptions,tagName:t.target.tagName,type:t.target.getAttribute("type"),value:n,maskInputFn:e.maskInputFn})),isBlocked(t.target,e.blockClass)||n===t.oldValue)return;var o=e.attributes.find((function(e){return e.node===t.target}));if(o||(o={node:t.target,attributes:{}},e.attributes.push(o)),"style"===t.attributeName){var i=e.doc.createElement("span");t.oldValue&&i.setAttribute("style",t.oldValue),void 0!==o.attributes.style&&null!==o.attributes.style||(o.attributes.style={});for(var s=o.attributes.style,a=0;a<r.style.length;a++){var u=r.style[a],l=r.style.getPropertyValue(u),c=r.style.getPropertyPriority(u);l==i.style.getPropertyValue(u)&&c==i.style.getPropertyPriority(u)||(s[u]=""==c?l:[l,c])}for(a=0;a<i.style.length;a++){u=i.style[a];""!==r.style.getPropertyValue(u)&&r.style.getPropertyValue(u)||(s[u]=!1)}}else o.attributes[t.attributeName]=transformAttribute(e.doc,t.target.tagName,t.attributeName,n);break;case"childList":t.addedNodes.forEach((function(n){return e.genAdds(n,t.target)})),t.removedNodes.forEach((function(n){var r=e.mirror.getId(n),o=isShadowRoot(t.target)?e.mirror.getId(t.target.host):e.mirror.getId(t.target);isBlocked(n,e.blockClass)||isBlocked(t.target,e.blockClass)||isIgnored(n)||(e.addedSet.has(n)?(deepDelete(e.addedSet,n),e.droppedSet.add(n)):e.addedSet.has(t.target)&&-1===r||isAncestorRemoved(t.target,e.mirror)||(e.movedSet.has(n)&&e.movedMap[moveKey(r,o)]?deepDelete(e.movedSet,n):e.removes.push({parentId:o,id:r,isShadow:!!isShadowRoot(t.target)||void 0})),e.mapRemoves.push(n))}))}},this.genAdds=function(t,n){if(!(isBlocked(t,e.blockClass)||n&&isBlocked(n,e.blockClass))){if(isINode(t)){if(isIgnored(t))return;e.movedSet.add(t);var r=null;n&&isINode(n)&&(r=n.__sn.id),r&&(e.movedMap[moveKey(t.__sn.id,r)]=!0)}else e.addedSet.add(t),e.droppedSet.delete(t);t.childNodes.forEach((function(t){return e.genAdds(t)}))}}}return e.prototype.init=function(e,t,n,r,o,i,s,a,u,l,c,f,d,p,h){this.blockClass=t,this.blockSelector=n,this.maskTextClass=r,this.maskTextSelector=o,this.inlineStylesheet=i,this.maskInputOptions=s,this.maskTextFn=a,this.maskInputFn=u,this.recordCanvas=l,this.slimDOMOptions=c,this.emissionCallback=e,this.doc=f,this.mirror=d,this.iframeManager=p,this.shadowDomManager=h},e.prototype.freeze=function(){this.frozen=!0},e.prototype.unfreeze=function(){this.frozen=!1,this.emit()},e.prototype.isFrozen=function(){return this.frozen},e.prototype.lock=function(){this.locked=!0},e.prototype.unlock=function(){this.locked=!1,this.emit()},e}();function deepDelete(e,t){e.delete(t),t.childNodes.forEach((function(t){return deepDelete(e,t)}))}function isParentRemoved(e,t,n){var r=t.parentNode;if(!r)return!1;var o=n.getId(r);return!!e.some((function(e){return e.id===o}))||isParentRemoved(e,r,n)}function isAncestorInSet(e,t){var n=t.parentNode;return!!n&&(!!e.has(n)||isAncestorInSet(e,n))}var mutationBuffers=[];function getEventTarget(e){try{if("composedPath"in e){var t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0];return e.target}catch(t){return e.target}}function initMutationObserver(e,t,n,r,o,i,s,a,u,l,c,f,d,p,h,m){var v,y,g,b=new MutationBuffer;mutationBuffers.push(b),b.init(e,n,r,o,i,s,a,u,l,c,f,t,d,p,h);var w=window.MutationObserver||window.__rrMutationObserver,S=null===(g=null===(y=null===(v=window)||void 0===v?void 0:v.Zone)||void 0===y?void 0:y.__symbol__)||void 0===g?void 0:g.call(y,"MutationObserver");S&&window[S]&&(w=window[S]);var k=new w(b.processMutations.bind(b));return k.observe(m,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),k}function initMoveObserver(e,t,n,r){if(!1===t.mousemove)return function(){};var o,i="number"==typeof t.mousemove?t.mousemove:50,s="number"==typeof t.mousemoveCallback?t.mousemoveCallback:500,a=[],u=throttle((function(t){var n=Date.now()-o;e(a.map((function(e){return e.timeOffset-=n,e})),t),a=[],o=null}),s),l=throttle((function(e){var t=getEventTarget(e),n=isTouchEvent(e)?e.changedTouches[0]:e,i=n.clientX,s=n.clientY;o||(o=Date.now()),a.push({x:i,y:s,id:r.getId(t),timeOffset:Date.now()-o}),u(e instanceof DragEvent?IncrementalSource.Drag:e instanceof MouseEvent?IncrementalSource.MouseMove:IncrementalSource.TouchMove)}),i,{trailing:!1}),c=[on("mousemove",l,n),on("touchmove",l,n),on("drag",l,n)];return function(){c.forEach((function(e){return e()}))}}function initMouseInteractionObserver(e,t,n,r,o){if(!1===o.mouseInteraction)return function(){};var i=!0===o.mouseInteraction||void 0===o.mouseInteraction?{}:o.mouseInteraction,s=[];return Object.keys(MouseInteractions).filter((function(e){return Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==i[e]})).forEach((function(o){var i=o.toLowerCase(),a=function(t){return function(o){var i=getEventTarget(o);if(!isBlocked(i,r)){var s=isTouchEvent(o)?o.changedTouches[0]:o;if(s){var a=n.getId(i),u=s.clientX,l=s.clientY;e({type:MouseInteractions[t],id:a,x:u,y:l})}}}}(o);s.push(on(i,a,t))})),function(){s.forEach((function(e){return e()}))}}function initScrollObserver(e,t,n,r,o){return on("scroll",throttle((function(o){var i=getEventTarget(o);if(i&&!isBlocked(i,r)){var s=n.getId(i);if(i===t){var a=t.scrollingElement||t.documentElement;e({id:s,x:a.scrollLeft,y:a.scrollTop})}else e({id:s,x:i.scrollLeft,y:i.scrollTop})}}),o.scroll||100),t)}function initViewportResizeObserver(e){var t=-1,n=-1;return on("resize",throttle((function(){var r=getWindowHeight(),o=getWindowWidth();t===r&&n===o||(e({width:Number(o),height:Number(r)}),t=r,n=o)}),200),window)}function wrapEventWithUserTriggeredFlag(e,t){var n=__assign({},e);return t||delete n.userTriggered,n}var INPUT_TAGS=["INPUT","TEXTAREA","SELECT"],lastInputValueMap=new WeakMap;function initInputObserver(e,t,n,r,o,i,s,a,u){function l(e){var n=getEventTarget(e),a=e.isTrusted;if(n&&n.tagName&&!(INPUT_TAGS.indexOf(n.tagName)<0)&&!isBlocked(n,r)){var l=n.type;if(!n.classList.contains(o)){var f=n.value,d=!1;"radio"===l||"checkbox"===l?d=n.checked:(i[n.tagName.toLowerCase()]||i[l])&&(f=maskInputValue({maskInputOptions:i,tagName:n.tagName,type:l,value:f,maskInputFn:s})),c(n,wrapEventWithUserTriggeredFlag({text:f,isChecked:d,userTriggered:a},u));var p=n.name;"radio"===l&&p&&d&&t.querySelectorAll('input[type="radio"][name="'+p+'"]').forEach((function(e){e!==n&&c(e,wrapEventWithUserTriggeredFlag({text:e.value,isChecked:!d,userTriggered:!1},u))}))}}}function c(t,r){var o=lastInputValueMap.get(t);if(!o||o.text!==r.text||o.isChecked!==r.isChecked){lastInputValueMap.set(t,r);var i=n.getId(t);e(__assign(__assign({},r),{id:i}))}}var f=("last"===a.input?["change"]:["input","change"]).map((function(e){return on(e,l,t)})),d=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),p=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"],[HTMLSelectElement.prototype,"selectedIndex"]];return d&&d.set&&f.push.apply(f,__spread(p.map((function(e){return hookSetter(e[0],e[1],{set:function(){l({target:this})}})})))),function(){f.forEach((function(e){return e()}))}}function initStyleSheetObserver(e,t){var n=CSSStyleSheet.prototype.insertRule;CSSStyleSheet.prototype.insertRule=function(r,o){var i=t.getId(this.ownerNode);return-1!==i&&e({id:i,adds:[{rule:r,index:o}]}),n.apply(this,arguments)};var r=CSSStyleSheet.prototype.deleteRule;return CSSStyleSheet.prototype.deleteRule=function(n){var o=t.getId(this.ownerNode);return-1!==o&&e({id:o,removes:[{index:n}]}),r.apply(this,arguments)},function(){CSSStyleSheet.prototype.insertRule=n,CSSStyleSheet.prototype.deleteRule=r}}function initMediaInteractionObserver(e,t,n){var r=function(r){return function(o){var i=getEventTarget(o);i&&!isBlocked(i,t)&&e({type:r,id:n.getId(i),currentTime:i.currentTime})}},o=[on("play",r(MediaInteractions.Play)),on("pause",r(MediaInteractions.Pause)),on("seeked",r(MediaInteractions.Seeked))];return function(){o.forEach((function(e){return e()}))}}function initCanvasMutationObserver(e,t,n){var r,o,i=Object.getOwnPropertyNames(CanvasRenderingContext2D.prototype),s=[],a=function(r){try{if("function"!=typeof CanvasRenderingContext2D.prototype[r])return"continue";var o=patch(CanvasRenderingContext2D.prototype,r,(function(o){return function(){for(var i=this,s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];return isBlocked(this.canvas,t)||setTimeout((function(){var t=__spread(s);if("drawImage"===r&&t[0]&&t[0]instanceof HTMLCanvasElement){var o=t[0],a=o.getContext("2d"),u=null==a?void 0:a.getImageData(0,0,o.width,o.height),l=null==u?void 0:u.data;t[0]=JSON.stringify(l)}e({id:n.getId(i.canvas),property:r,args:t})}),0),o.apply(this,s)}}));s.push(o)}catch(t){var i=hookSetter(CanvasRenderingContext2D.prototype,r,{set:function(t){e({id:n.getId(this.canvas),property:r,args:[t],setter:!0})}});s.push(i)}};try{for(var u=__values(i),l=u.next();!l.done;l=u.next()){a(l.value)}}catch(e){r={error:e}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(r)throw r.error}}return function(){s.forEach((function(e){return e()}))}}function initFontObserver(e){var t=[],n=new WeakMap,r=FontFace;window.FontFace=function(e,t,o){var i=new r(e,t,o);return n.set(i,{family:e,buffer:"string"!=typeof t,descriptors:o,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),i};var o=patch(document.fonts,"add",(function(t){return function(r){return setTimeout((function(){var t=n.get(r);t&&(e(t),n.delete(r))}),0),t.apply(this,[r])}}));return t.push((function(){window.FonFace=r})),t.push(o),function(){t.forEach((function(e){return e()}))}}function mergeHooks(e,t){var n=e.mutationCb,r=e.mousemoveCb,o=e.mouseInteractionCb,i=e.scrollCb,s=e.viewportResizeCb,a=e.inputCb,u=e.mediaInteractionCb,l=e.styleSheetRuleCb,c=e.canvasMutationCb,f=e.fontCb;e.mutationCb=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.mutation&&t.mutation.apply(t,__spread(e)),n.apply(void 0,__spread(e))},e.mousemoveCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mousemove&&t.mousemove.apply(t,__spread(e)),r.apply(void 0,__spread(e))},e.mouseInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mouseInteraction&&t.mouseInteraction.apply(t,__spread(e)),o.apply(void 0,__spread(e))},e.scrollCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.scroll&&t.scroll.apply(t,__spread(e)),i.apply(void 0,__spread(e))},e.viewportResizeCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.viewportResize&&t.viewportResize.apply(t,__spread(e)),s.apply(void 0,__spread(e))},e.inputCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.input&&t.input.apply(t,__spread(e)),a.apply(void 0,__spread(e))},e.mediaInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mediaInteaction&&t.mediaInteaction.apply(t,__spread(e)),u.apply(void 0,__spread(e))},e.styleSheetRuleCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.styleSheetRule&&t.styleSheetRule.apply(t,__spread(e)),l.apply(void 0,__spread(e))},e.canvasMutationCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.canvasMutation&&t.canvasMutation.apply(t,__spread(e)),c.apply(void 0,__spread(e))},e.fontCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.font&&t.font.apply(t,__spread(e)),f.apply(void 0,__spread(e))}}function initObservers(e,t){var n,r;void 0===t&&(t={}),mergeHooks(e,t);var o=initMutationObserver(e.mutationCb,e.doc,e.blockClass,e.blockSelector,e.maskTextClass,e.maskTextSelector,e.inlineStylesheet,e.maskInputOptions,e.maskTextFn,e.maskInputFn,e.recordCanvas,e.slimDOMOptions,e.mirror,e.iframeManager,e.shadowDomManager,e.doc),i=initMoveObserver(e.mousemoveCb,e.sampling,e.doc,e.mirror),s=initMouseInteractionObserver(e.mouseInteractionCb,e.doc,e.mirror,e.blockClass,e.sampling),a=initScrollObserver(e.scrollCb,e.doc,e.mirror,e.blockClass,e.sampling),u=initViewportResizeObserver(e.viewportResizeCb),l=initInputObserver(e.inputCb,e.doc,e.mirror,e.blockClass,e.ignoreClass,e.maskInputOptions,e.maskInputFn,e.sampling,e.userTriggeredOnInput),c=initMediaInteractionObserver(e.mediaInteractionCb,e.blockClass,e.mirror),f=initStyleSheetObserver(e.styleSheetRuleCb,e.mirror),d=e.recordCanvas?initCanvasMutationObserver(e.canvasMutationCb,e.blockClass,e.mirror):function(){},p=e.collectFonts?initFontObserver(e.fontCb):function(){},h=[];try{for(var m=__values(e.plugins),v=m.next();!v.done;v=m.next()){var y=v.value;h.push(y.observer(y.callback,y.options))}}catch(e){n={error:e}}finally{try{v&&!v.done&&(r=m.return)&&r.call(m)}finally{if(n)throw n.error}}return function(){o.disconnect(),i(),s(),a(),u(),l(),c(),f(),d(),p(),h.forEach((function(e){return e()}))}}var IframeManager=function(){function e(e){this.iframes=new WeakMap,this.mutationCb=e.mutationCb}return e.prototype.addIframe=function(e){this.iframes.set(e,!0)},e.prototype.addLoadListener=function(e){this.loadListener=e},e.prototype.attachIframe=function(e,t){var n;this.mutationCb({adds:[{parentId:e.__sn.id,nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,e)},e}(),ShadowDomManager=function(){function e(e){this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror}return e.prototype.addShadowRoot=function(e,t){initMutationObserver(this.mutationCb,t,this.bypassOptions.blockClass,this.bypassOptions.blockSelector,this.bypassOptions.maskTextClass,this.bypassOptions.maskTextSelector,this.bypassOptions.inlineStylesheet,this.bypassOptions.maskInputOptions,this.bypassOptions.maskTextFn,this.bypassOptions.maskInputFn,this.bypassOptions.recordCanvas,this.bypassOptions.slimDOMOptions,this.mirror,this.bypassOptions.iframeManager,this,e),initScrollObserver(this.scrollCb,e,this.mirror,this.bypassOptions.blockClass,this.bypassOptions.sampling)},e}(),wrappedEmit,takeFullSnapshot;function wrapEvent(e){return __assign(__assign({},e),{timestamp:Date.now()})}var mirror=createMirror();function record(e){void 0===e&&(e={});var t=e.emit,n=e.checkoutEveryNms,r=e.checkoutEveryNth,o=e.blockClass,i=void 0===o?"rr-block":o,s=e.blockSelector,a=void 0===s?null:s,u=e.ignoreClass,l=void 0===u?"rr-ignore":u,c=e.maskTextClass,f=void 0===c?"rr-mask":c,d=e.maskTextSelector,p=void 0===d?null:d,h=e.inlineStylesheet,m=void 0===h||h,v=e.maskAllInputs,y=e.maskInputOptions,g=e.slimDOMOptions,b=e.maskInputFn,w=e.maskTextFn,S=e.hooks,k=e.packFn,E=e.sampling,_=void 0===E?{}:E,O=e.mousemoveWait,I=e.recordCanvas,C=void 0!==I&&I,R=e.userTriggeredOnInput,T=void 0!==R&&R,x=e.collectFonts,$=void 0!==x&&x,N=e.plugins,M=e.keepIframeSrcFn,L=void 0===M?function(){return!1}:M;if(!t)throw new Error("emit function is required");void 0!==O&&void 0===_.mousemove&&(_.mousemove=O);var B,D=!0===v?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==y?y:{password:!0},A=!0===g||"all"===g?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===g,headMetaDescKeywords:"all"===g}:g||{};polyfill();var F=0;wrappedEmit=function(e,o){var i;if(!(null===(i=mutationBuffers[0])||void 0===i?void 0:i.isFrozen())||e.type===EventType.FullSnapshot||e.type===EventType.IncrementalSnapshot&&e.data.source===IncrementalSource.Mutation||mutationBuffers.forEach((function(e){return e.unfreeze()})),t(k?k(e):e,o),e.type===EventType.FullSnapshot)B=e,F=0;else if(e.type===EventType.IncrementalSnapshot){if(e.data.source===IncrementalSource.Mutation&&e.data.isAttachIframe)return;F++;var s=r&&F>=r,a=n&&e.timestamp-B.timestamp>n;(s||a)&&takeFullSnapshot(!0)}};var W=function(e){wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.Mutation},e)}))},P=function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.Scroll},e)}))},j=new IframeManager({mutationCb:W}),z=new ShadowDomManager({mutationCb:W,scrollCb:P,bypassOptions:{blockClass:i,blockSelector:a,maskTextClass:f,maskTextSelector:p,inlineStylesheet:m,maskInputOptions:D,maskTextFn:w,maskInputFn:b,recordCanvas:C,sampling:_,slimDOMOptions:A,iframeManager:j},mirror:mirror});takeFullSnapshot=function(e){var t,n,r,o;void 0===e&&(e=!1),wrappedEmit(wrapEvent({type:EventType.Meta,data:{href:window.location.href,width:getWindowWidth(),height:getWindowHeight()}}),e),mutationBuffers.forEach((function(e){return e.lock()}));var s=__read(snapshot(document,{blockClass:i,blockSelector:a,maskTextClass:f,maskTextSelector:p,inlineStylesheet:m,maskAllInputs:D,maskTextFn:w,slimDOM:A,recordCanvas:C,onSerialize:function(e){isIframeINode(e)&&j.addIframe(e),hasShadowRoot(e)&&z.addShadowRoot(e.shadowRoot,document)},onIframeLoad:function(e,t){j.attachIframe(e,t)},keepIframeSrcFn:L}),2),u=s[0],l=s[1];if(!u)return console.warn("Failed to snapshot the document");mirror.map=l,wrappedEmit(wrapEvent({type:EventType.FullSnapshot,data:{node:u,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(n=null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===document||void 0===document?void 0:document.body.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(o=null===(r=null===document||void 0===document?void 0:document.body)||void 0===r?void 0:r.parentElement)||void 0===o?void 0:o.scrollTop)||(null===document||void 0===document?void 0:document.body.scrollTop)||0}}})),mutationBuffers.forEach((function(e){return e.unlock()}))};try{var U=[];U.push(on("DOMContentLoaded",(function(){wrappedEmit(wrapEvent({type:EventType.DomContentLoaded,data:{}}))})));var V=function(e){return initObservers({mutationCb:W,mousemoveCb:function(e,t){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:{source:t,positions:e}}))},mouseInteractionCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.MouseInteraction},e)}))},scrollCb:P,viewportResizeCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.ViewportResize},e)}))},inputCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.Input},e)}))},mediaInteractionCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.MediaInteraction},e)}))},styleSheetRuleCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.StyleSheetRule},e)}))},canvasMutationCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.CanvasMutation},e)}))},fontCb:function(e){return wrappedEmit(wrapEvent({type:EventType.IncrementalSnapshot,data:__assign({source:IncrementalSource.Font},e)}))},blockClass:i,ignoreClass:l,maskTextClass:f,maskTextSelector:p,maskInputOptions:D,inlineStylesheet:m,sampling:_,recordCanvas:C,userTriggeredOnInput:T,collectFonts:$,doc:e,maskInputFn:b,maskTextFn:w,blockSelector:a,slimDOMOptions:A,mirror:mirror,iframeManager:j,shadowDomManager:z,plugins:(null==N?void 0:N.map((function(e){return{observer:e.observer,options:e.options,callback:function(t){return wrappedEmit(wrapEvent({type:EventType.Plugin,data:{plugin:e.name,payload:t}}))}}})))||[]},S)};j.addLoadListener((function(e){U.push(V(e.contentDocument))}));var H=function(){takeFullSnapshot(),U.push(V(document))};return"interactive"===document.readyState||"complete"===document.readyState?H():U.push(on("load",(function(){wrappedEmit(wrapEvent({type:EventType.Load,data:{}})),H()}),window)),function(){U.forEach((function(e){return e()}))}}catch(e){console.warn(e)}}record.addCustomEvent=function(e,t){if(!wrappedEmit)throw new Error("please add custom event after start recording");wrappedEmit(wrapEvent({type:EventType.Custom,data:{tag:e,payload:t}}))},record.freezePage=function(){mutationBuffers.forEach((function(e){return e.freeze()}))},record.takeFullSnapshot=function(e){if(!takeFullSnapshot)throw new Error("please take full snapshot after start recording");takeFullSnapshot(e)},record.mirror=mirror;var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var n=new Array(arguments.length-1),r=0,o=2,i=!0;o<arguments.length;)n[r++]=arguments[o++];return new Promise((function(o,s){n[r]=function(e){if(i)if(i=!1,e)s(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];o.apply(null,t)}};try{e.apply(t||null,n)}catch(e){i&&(i=!1,s(e))}}))}var base64$1={};!function(e){var t=base64$1;t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var n=new Array(64),r=new Array(123),o=0;o<64;)r[n[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;t.encode=function(e,t,r){for(var o,i=null,s=[],a=0,u=0;t<r;){var l=e[t++];switch(u){case 0:s[a++]=n[l>>2],o=(3&l)<<4,u=1;break;case 1:s[a++]=n[o|l>>4],o=(15&l)<<2,u=2;break;case 2:s[a++]=n[o|l>>6],s[a++]=n[63&l],u=0}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=n[o],s[a++]=61,1===u&&(s[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var i="invalid encoding";t.decode=function(e,t,n){for(var o,s=n,a=0,u=0;u<e.length;){var l=e.charCodeAt(u++);if(61===l&&a>1)break;if(void 0===(l=r[l]))throw Error(i);switch(a){case 0:o=l,a=1;break;case 1:t[n++]=o<<2|(48&l)>>4,o=l,a=2;break;case 2:t[n++]=(15&o)<<4|(60&l)>>2,o=l,a=3;break;case 3:t[n++]=(3&o)<<6|l,a=0}}if(1===a)throw Error(i);return n-s},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}();var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},EventEmitter.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var float=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function o(e,r,o){t[0]=e,r[o]=n[0],r[o+1]=n[1],r[o+2]=n[2],r[o+3]=n[3]}function i(e,r,o){t[0]=e,r[o]=n[3],r[o+1]=n[2],r[o+2]=n[1],r[o+3]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function a(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?o:i,e.writeFloatBE=r?i:o,e.readFloatLE=r?s:a,e.readFloatBE=r?a:s}():function(){function t(e,t,n,r){var o=t<0?1:0;if(o&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((o<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((o<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var i=Math.floor(Math.log(t)/Math.LN2);e((o<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,n,r)}}function n(e,t,n){var r=e(t,n),o=2*(r>>31)+1,i=r>>>23&255,s=8388607&r;return 255===i?s?NaN:o*(1/0):0===i?1401298464324817e-60*o*s:o*Math.pow(2,i-150)*(s+8388608)}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE),e.readFloatLE=n.bind(null,readUintLE),e.readFloatBE=n.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function o(e,r,o){t[0]=e,r[o]=n[0],r[o+1]=n[1],r[o+2]=n[2],r[o+3]=n[3],r[o+4]=n[4],r[o+5]=n[5],r[o+6]=n[6],r[o+7]=n[7]}function i(e,r,o){t[0]=e,r[o]=n[7],r[o+1]=n[6],r[o+2]=n[5],r[o+3]=n[4],r[o+4]=n[3],r[o+5]=n[2],r[o+6]=n[1],r[o+7]=n[0]}function s(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function a(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?o:i,e.writeDoubleBE=r?i:o,e.readDoubleLE=r?s:a,e.readDoubleBE=r?a:s}():function(){function t(e,t,n,r,o,i){var s=r<0?1:0;if(s&&(r=-r),0===r)e(0,o,i+t),e(1/r>0?0:2147483648,o,i+n);else if(isNaN(r))e(0,o,i+t),e(2146959360,o,i+n);else if(r>17976931348623157e292)e(0,o,i+t),e((s<<31|2146435072)>>>0,o,i+n);else{var a;if(r<22250738585072014e-324)e((a=r/5e-324)>>>0,o,i+t),e((s<<31|a/4294967296)>>>0,o,i+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=r*Math.pow(2,-u))>>>0,o,i+t),e((s<<31|u+1023<<20|1048576*a&1048575)>>>0,o,i+n)}}}function n(e,t,n,r,o){var i=e(r,o+t),s=e(r,o+n),a=2*(s>>31)+1,u=s>>>20&2047,l=4294967296*(1048575&s)+i;return 2047===u?l?NaN:a*(1/0):0===u?5e-324*a*l:a*Math.pow(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0),e.readDoubleLE=n.bind(null,readUintLE,0,4),e.readDoubleBE=n.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function writeUintBE(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};!function(e){var t=utf8$2;t.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},t.read=function(e,t,n){if(n-t<1)return"";for(var r,o=null,i=[],s=0;t<n;)(r=e[t++])<128?i[s++]=r:r>191&&r<224?i[s++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[s++]=55296+(r>>10),i[s++]=56320+(1023&r)):i[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,i)),s=0);return o?(s&&o.push(String.fromCharCode.apply(String,i.slice(0,s))),o.join("")):String.fromCharCode.apply(String,i.slice(0,s))},t.write=function(e,t,n){for(var r,o,i=n,s=0;s<e.length;++s)(r=e.charCodeAt(s))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&56320==(64512&(o=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&o),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-i}}();var pool_1=pool;function pool(e,t,n){var r=n||8192,o=r>>>1,i=null,s=r;return function(n){if(n<1||n>o)return e(n);s+n>r&&(i=e(r),s=0);var a=t.call(i,s,s+=n);return 7&s&&(s=1+(7|s)),a}}var longbits=LongBits$2,util$5=minimal$1;function LongBits$2(e,t){this.lo=e>>>0,this.hi=t>>>0}var zero=LongBits$2.zero=new LongBits$2(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits$2.zeroHash="\0\0\0\0\0\0\0\0";LongBits$2.fromNumber=function(e){if(0===e)return zero;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new LongBits$2(n,r)},LongBits$2.from=function(e){if("number"==typeof e)return LongBits$2.fromNumber(e);if(util$5.isString(e)){if(!util$5.Long)return LongBits$2.fromNumber(parseInt(e,10));e=util$5.Long.fromString(e)}return e.low||e.high?new LongBits$2(e.low>>>0,e.high>>>0):zero},LongBits$2.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},LongBits$2.prototype.toLong=function(e){return util$5.Long?new util$5.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var charCodeAt=String.prototype.charCodeAt;LongBits$2.fromHash=function(e){return e===zeroHash?zero:new LongBits$2((charCodeAt.call(e,0)|charCodeAt.call(e,1)<<8|charCodeAt.call(e,2)<<16|charCodeAt.call(e,3)<<24)>>>0,(charCodeAt.call(e,4)|charCodeAt.call(e,5)<<8|charCodeAt.call(e,6)<<16|charCodeAt.call(e,7)<<24)>>>0)},LongBits$2.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits$2.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},LongBits$2.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},LongBits$2.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10},function(e){var t=minimal$1;function n(e,t,n){for(var r=Object.keys(t),o=0;o<r.length;++o)void 0!==e[r[o]]&&n||(e[r[o]]=t[r[o]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=longbits,t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){var r=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(r.lo,r.hi,n):r.toNumber(Boolean(n))},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}();var writer=Writer$1,util$4=minimal$1,BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,n){t[n]=255&e}function writeVarint32(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function writeFixed32(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Op(e,t,n),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var n=Writer$1.alloc(t=base64.length(e));base64.decode(e,n,0),e=n}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=minimal$1;function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,n){e.length<40?util$3.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=minimal$1,BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=minimal$1;function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=minimal$1,exports;function Service(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,n,r,o,i){if(!o)throw TypeError("request must be specified");var s=this;if(!i)return util.asPromise(e,s,t,n,r,o);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,n){if(e)return s.emit("error",e,t),i(e);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),i(e)}return s.emit("data",n,t),i(null,n)}s.end(!0)}))}catch(e){return s.emit("error",e,t),void setTimeout((function(){i(e)}),0)}else setTimeout((function(){i(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},exports=rpc,exports.Service=service;var roots={};!function(e){var t=indexMinimal;function n(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=minimal$1,t.rpc=rpc,t.roots=roots,t.configure=n,n()}();var minimal=indexMinimal;const $Reader=minimal.Reader,$Writer=minimal.Writer,$util=minimal.util,$root=minimal.roots.default||(minimal.roots.default={});$root.DOMEvent=(()=>{function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.n=0,e.prototype.event="",e.prototype.isCheckout=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(0).uint32(e.n),null!=e.event&&Object.hasOwnProperty.call(e,"event")&&t.uint32(10).string(e.event),null!=e.isCheckout&&Object.hasOwnProperty.call(e,"isCheckout")&&t.uint32(16).bool(e.isCheckout),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let n=void 0===t?e.len:e.pos+t,r=new $root.DOMEvent;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 0:r.n=e.uint32();break;case 1:r.event=e.string();break;case 2:r.isCheckout=e.bool();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.n&&e.hasOwnProperty("n")&&!$util.isInteger(e.n)?"n: integer expected":null!=e.event&&e.hasOwnProperty("event")&&!$util.isString(e.event)?"event: string expected":null!=e.isCheckout&&e.hasOwnProperty("isCheckout")&&"boolean"!=typeof e.isCheckout?"isCheckout: boolean expected":null},e.fromObject=function(e){if(e instanceof $root.DOMEvent)return e;let t=new $root.DOMEvent;return null!=e.n&&(t.n=e.n>>>0),null!=e.event&&(t.event=String(e.event)),null!=e.isCheckout&&(t.isCheckout=Boolean(e.isCheckout)),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.n=0,n.event="",n.isCheckout=!1),null!=e.n&&e.hasOwnProperty("n")&&(n.n=e.n),null!=e.event&&e.hasOwnProperty("event")&&(n.event=e.event),null!=e.isCheckout&&e.hasOwnProperty("isCheckout")&&(n.isCheckout=e.isCheckout),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})();const ReportRequest=$root.ReportRequest=(()=>{function e(e){if(this.events=[],e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.session=$util.newBuffer([]),e.prototype.events=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(2).bytes(e.session),null!=e.events&&e.events.length)for(let n=0;n<e.events.length;++n)$root.DOMEvent.encode(e.events[n],t.uint32(10).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let n=void 0===t?e.len:e.pos+t,r=new $root.ReportRequest;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 0:r.session=e.bytes();break;case 1:r.events&&r.events.length||(r.events=[]),r.events.push($root.DOMEvent.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.session&&e.hasOwnProperty("session")&&!(e.session&&"number"==typeof e.session.length||$util.isString(e.session)))return"session: buffer expected";if(null!=e.events&&e.hasOwnProperty("events")){if(!Array.isArray(e.events))return"events: array expected";for(let t=0;t<e.events.length;++t){let n=$root.DOMEvent.verify(e.events[t]);if(n)return"events."+n}}return null},e.fromObject=function(e){if(e instanceof $root.ReportRequest)return e;let t=new $root.ReportRequest;if(null!=e.session&&("string"==typeof e.session?$util.base64.decode(e.session,t.session=$util.newBuffer($util.base64.length(e.session)),0):e.session.length&&(t.session=e.session)),e.events){if(!Array.isArray(e.events))throw TypeError(".ReportRequest.events: array expected");t.events=[];for(let n=0;n<e.events.length;++n){if("object"!=typeof e.events[n])throw TypeError(".ReportRequest.events: object expected");t.events[n]=$root.DOMEvent.fromObject(e.events[n])}}return t},e.toObject=function(e,t){t||(t={});let n={};if((t.arrays||t.defaults)&&(n.events=[]),t.defaults&&(t.bytes===String?n.session="":(n.session=[],t.bytes!==Array&&(n.session=$util.newBuffer(n.session)))),null!=e.session&&e.hasOwnProperty("session")&&(n.session=t.bytes===String?$util.base64.encode(e.session,0,e.session.length):t.bytes===Array?Array.prototype.slice.call(e.session):e.session),e.events&&e.events.length){n.events=[];for(let r=0;r<e.events.length;++r)n.events[r]=$root.DOMEvent.toObject(e.events[r],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})(),ReportResponse=$root.ReportResponse=(()=>{function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id="",e.prototype.session=$util.newBuffer([]),e.prototype.acknowledge=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&t.uint32(2).string(e.id),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(10).bytes(e.session),null!=e.acknowledge&&Object.hasOwnProperty.call(e,"acknowledge")&&t.uint32(16).uint32(e.acknowledge),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let n=void 0===t?e.len:e.pos+t,r=new $root.ReportResponse;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 0:r.id=e.string();break;case 1:r.session=e.bytes();break;case 2:r.acknowledge=e.uint32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isString(e.id)?"id: string expected":null!=e.session&&e.hasOwnProperty("session")&&!(e.session&&"number"==typeof e.session.length||$util.isString(e.session))?"session: buffer expected":null!=e.acknowledge&&e.hasOwnProperty("acknowledge")&&!$util.isInteger(e.acknowledge)?"acknowledge: integer expected":null},e.fromObject=function(e){if(e instanceof $root.ReportResponse)return e;let t=new $root.ReportResponse;return null!=e.id&&(t.id=String(e.id)),null!=e.session&&("string"==typeof e.session?$util.base64.decode(e.session,t.session=$util.newBuffer($util.base64.length(e.session)),0):e.session.length&&(t.session=e.session)),null!=e.acknowledge&&(t.acknowledge=e.acknowledge>>>0),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.id="",t.bytes===String?n.session="":(n.session=[],t.bytes!==Array&&(n.session=$util.newBuffer(n.session))),n.acknowledge=0),null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.session&&e.hasOwnProperty("session")&&(n.session=t.bytes===String?$util.base64.encode(e.session,0,e.session.length):t.bytes===Array?Array.prototype.slice.call(e.session):e.session),null!=e.acknowledge&&e.hasOwnProperty("acknowledge")&&(n.acknowledge=e.acknowledge),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})();$root.ReviewRequest=(()=>{function e(e){if(e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.n=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(0).uint32(e.n),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let n=void 0===t?e.len:e.pos+t,r=new $root.ReviewRequest;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 0:r.n=e.uint32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.n&&e.hasOwnProperty("n")&&!$util.isInteger(e.n)?"n: integer expected":null},e.fromObject=function(e){if(e instanceof $root.ReviewRequest)return e;let t=new $root.ReviewRequest;return null!=e.n&&(t.n=e.n>>>0),t},e.toObject=function(e,t){t||(t={});let n={};return t.defaults&&(n.n=0),null!=e.n&&e.hasOwnProperty("n")&&(n.n=e.n),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})(),$root.ReviewResponse=(()=>{function e(e){if(this.event=[],e)for(let t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.event=$util.emptyArray,e.prototype.n=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.event&&e.event.length)for(let n=0;n<e.event.length;++n)t.uint32(2).string(e.event[n]);return null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(8).uint32(e.n),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let n=void 0===t?e.len:e.pos+t,r=new $root.ReviewResponse;for(;e.pos<n;){let t=e.uint32();switch(t>>>3){case 0:r.event&&r.event.length||(r.event=[]),r.event.push(e.string());break;case 1:r.n=e.uint32();break;default:e.skipType(7&t)}}return r},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.event&&e.hasOwnProperty("event")){if(!Array.isArray(e.event))return"event: array expected";for(let t=0;t<e.event.length;++t)if(!$util.isString(e.event[t]))return"event: string[] expected"}return null!=e.n&&e.hasOwnProperty("n")&&!$util.isInteger(e.n)?"n: integer expected":null},e.fromObject=function(e){if(e instanceof $root.ReviewResponse)return e;let t=new $root.ReviewResponse;if(e.event){if(!Array.isArray(e.event))throw TypeError(".ReviewResponse.event: array expected");t.event=[];for(let n=0;n<e.event.length;++n)t.event[n]=String(e.event[n])}return null!=e.n&&(t.n=e.n>>>0),t},e.toObject=function(e,t){t||(t={});let n={};if((t.arrays||t.defaults)&&(n.event=[]),t.defaults&&(n.n=0),e.event&&e.event.length){n.event=[];for(let t=0;t<e.event.length;++t)n.event[t]=e.event[t]}return null!=e.n&&e.hasOwnProperty("n")&&(n.n=e.n),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})();class ReportStream{constructor(e,t){this.streamId=e,this.session=t,this.events=[],this.eventCount=0,record({emit:(e,t)=>this.event(e,t)})}async getSender(){return this.websocket?this.websocket:this.websocket=new Promise(((e,t)=>{try{let n=0;const r=new WebSocket(this.getWSUrl(),["report"]);r.binaryType="arraybuffer";const o=()=>{const e=this.events.slice(n);if(0===e.length)return;const t=ReportRequest.encode({events:e}).finish();r.send(t),n+=e.length};r.addEventListener("open",(()=>{e(o)})),r.addEventListener("error",(e=>{this.websocket=void 0,t(e),console.error(e)})),r.addEventListener("close",(e=>{this.websocket=void 0,t(e),console.error(e)})),r.addEventListener("message",(({data:e})=>{try{if(!(e instanceof ArrayBuffer))return;const t=ReportResponse.decode(new Uint8Array(e));console.info(t);const{acknowledge:r,session:o,id:i}=t;if("string"==typeof i&&(this.streamId=i,window.postMessage(i,"*")),o&&o.length>0&&(this.session=o),"number"==typeof r)for(;this.events.length>0;){const e=this.events[0];if("number"!=typeof e.n||e.n>=r)break;this.events.shift(),n--}}catch(e){console.error(e),r.close(4400,e)}}))}catch(e){console.error(e),t(e)}}))}async send(){return this.sendPromise?this.sendPromise:this.sendPromise=new Promise((async e=>{try{(await this.getSender())()}catch(e){console.error(e)}finally{e(),this.sendPromise=void 0}}))}event(e,t){this.events.push({event:JSON.stringify(e),isCheckout:t,n:this.eventCount++}),this.send()}getWSUrl(){const e=new URL(location.toString());return e.protocol="wss:",e.pathname="/api/activityStream",this.streamId&&(e.pathname=`${e.pathname}/${this.streamId}`),e.toString()}}new ReportStream;
