var EventType,IncrementalSource,MouseInteractions,MediaInteractions,ReplayerEvents;!function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin"}(EventType||(EventType={})),function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag"}(IncrementalSource||(IncrementalSource={})),function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd"}(MouseInteractions||(MouseInteractions={})),function(e){e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked"}(MediaInteractions||(MediaInteractions={})),function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back"}(ReplayerEvents||(ReplayerEvents={}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},NodeType;function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}function isElement(e){return e.nodeType===e.ELEMENT_NODE}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(NodeType||(NodeType={}));var commentre=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;function parse(e,t){void 0===t&&(t={});var r=1,n=1;function i(e){var t=e.match(/\n/g);t&&(r+=t.length);var i=e.lastIndexOf("\n");n=-1===i?n+e.length:e.length-i}function o(){var e={line:r,column:n};return function(t){return t.position=new s(e),p(),t}}var s=function(e){this.start=e,this.end={line:r,column:n},this.source=t.source};s.prototype.content=e;var a=[];function l(i){var o=new Error(t.source+":"+r+":"+n+": "+i);if(o.reason=i,o.filename=t.source,o.line=r,o.column=n,o.source=e,!t.silent)throw o;a.push(o)}function u(){return d(/^{\s*/)}function c(){return d(/^}/)}function f(){var t,r=[];for(p(),h(r);e.length&&"}"!==e.charAt(0)&&(t=x()||T());)!1!==t&&(r.push(t),h(r));return r}function d(t){var r=t.exec(e);if(r){var n=r[0];return i(n),e=e.slice(n.length),r}}function p(){d(/^\s*/)}function h(e){var t;for(void 0===e&&(e=[]);t=v();)!1!==t&&e.push(t),t=v();return e}function v(){var t=o();if("/"===e.charAt(0)&&"*"===e.charAt(1)){for(var r=2;""!==e.charAt(r)&&("*"!==e.charAt(r)||"/"!==e.charAt(r+1));)++r;if(r+=2,""===e.charAt(r-1))return l("End of comment missing");var s=e.slice(2,r-2);return n+=2,i(s),e=e.slice(r),n+=2,t({type:"comment",comment:s})}}function m(){var e=d(/^([^{]+)/);if(e)return trim(e[0]).replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,(function(e){return e.replace(/,/g,"â€Œ")})).split(/\s*(?![^(]*\)),\s*/).map((function(e){return e.replace(/\u200C/g,",")}))}function y(){var e=o(),t=d(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(t){var r=trim(t[0]);if(!d(/^:\s*/))return l("property missing ':'");var n=d(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),i=e({type:"declaration",property:r.replace(commentre,""),value:n?trim(n[0]).replace(commentre,""):""});return d(/^[;\s]*/),i}}function g(){var e,t=[];if(!u())return l("missing '{'");for(h(t);e=y();)!1!==e&&(t.push(e),h(t)),e=y();return c()?t:l("missing '}'")}function b(){for(var e,t=[],r=o();e=d(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)t.push(e[1]),d(/^,\s*/);if(t.length)return r({type:"keyframe",values:t,declarations:g()})}var w,S=_("import"),E=_("charset"),R=_("namespace");function _(e){var t=new RegExp("^@"+e+"\\s*([^;]+);");return function(){var r=o(),n=d(t);if(n){var i={type:e};return i[e]=n[1].trim(),r(i)}}}function x(){if("@"===e[0])return function(){var e=o(),t=d(/^@([-\w]+)?keyframes\s*/);if(t){var r=t[1];if(!(t=d(/^([-\w]+)\s*/)))return l("@keyframes missing name");var n,i=t[1];if(!u())return l("@keyframes missing '{'");for(var s=h();n=b();)s.push(n),s=s.concat(h());return c()?e({type:"keyframes",name:i,vendor:r,keyframes:s}):l("@keyframes missing '}'")}}()||function(){var e=o(),t=d(/^@media *([^{]+)/);if(t){var r=trim(t[1]);if(!u())return l("@media missing '{'");var n=h().concat(f());return c()?e({type:"media",media:r,rules:n}):l("@media missing '}'")}}()||function(){var e=o(),t=d(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(t)return e({type:"custom-media",name:trim(t[1]),media:trim(t[2])})}()||function(){var e=o(),t=d(/^@supports *([^{]+)/);if(t){var r=trim(t[1]);if(!u())return l("@supports missing '{'");var n=h().concat(f());return c()?e({type:"supports",supports:r,rules:n}):l("@supports missing '}'")}}()||S()||E()||R()||function(){var e=o(),t=d(/^@([-\w]+)?document *([^{]+)/);if(t){var r=trim(t[1]),n=trim(t[2]);if(!u())return l("@document missing '{'");var i=h().concat(f());return c()?e({type:"document",document:n,vendor:r,rules:i}):l("@document missing '}'")}}()||function(){var e=o();if(d(/^@page */)){var t=m()||[];if(!u())return l("@page missing '{'");for(var r,n=h();r=y();)n.push(r),n=n.concat(h());return c()?e({type:"page",selectors:t,declarations:n}):l("@page missing '}'")}}()||function(){var e=o();if(d(/^@host\s*/)){if(!u())return l("@host missing '{'");var t=h().concat(f());return c()?e({type:"host",rules:t}):l("@host missing '}'")}}()||function(){var e=o();if(d(/^@font-face\s*/)){if(!u())return l("@font-face missing '{'");for(var t,r=h();t=y();)r.push(t),r=r.concat(h());return c()?e({type:"font-face",declarations:r}):l("@font-face missing '}'")}}()}function T(){var e=o(),t=m();return t?(h(),e({type:"rule",selectors:t,declarations:g()})):l("selector missing")}return addParent((w=f(),{type:"stylesheet",stylesheet:{source:t.source,rules:w,parsingErrors:a}}))}function trim(e){return e?e.replace(/^\s+|\s+$/g,""):""}function addParent(e,t){for(var r=e&&"string"==typeof e.type,n=r?e:t,i=0,o=Object.keys(e);i<o.length;i++){var s=e[o[i]];Array.isArray(s)?s.forEach((function(e){addParent(e,n)})):s&&"object"==typeof s&&addParent(s,n)}return r&&Object.defineProperty(e,"parent",{configurable:!0,writable:!0,enumerable:!1,value:t||null}),e}var tagMap={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};function getTagName(e){var t=tagMap[e.tagName]?tagMap[e.tagName]:e.tagName;return"link"===t&&e.attributes._cssText&&(t="style"),t}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var HOVER_SELECTOR=/([^\\]):hover/,HOVER_SELECTOR_GLOBAL=new RegExp(HOVER_SELECTOR,"g");function addHoverClass(e){var t=parse(e,{silent:!0});if(!t.stylesheet)return e;var r=[];if(t.stylesheet.rules.forEach((function(e){"selectors"in e&&(e.selectors||[]).forEach((function(e){HOVER_SELECTOR.test(e)&&r.push(e)}))})),0===r.length)return e;var n=new RegExp(r.filter((function(e,t){return r.indexOf(e)===t})).sort((function(e,t){return t.length-e.length})).map((function(e){return escapeRegExp(e)})).join("|"),"g");return e.replace(n,(function(e){var t=e.replace(HOVER_SELECTOR_GLOBAL,"$1.\\:hover");return e+", "+t}))}function buildNode(e,t){var r=t.doc,n=t.hackCss;switch(e.type){case NodeType.Document:return r.implementation.createDocument(null,"",null);case NodeType.DocumentType:return r.implementation.createDocumentType(e.name||"html",e.publicId,e.systemId);case NodeType.Element:var i,o=getTagName(e);i=e.isSVG?r.createElementNS("http://www.w3.org/2000/svg",o):r.createElement(o);var s=function(t){if(!e.attributes.hasOwnProperty(t))return"continue";var s=e.attributes[t];if(s="boolean"==typeof s||"number"==typeof s?"":s,t.startsWith("rr_")){if("canvas"===o&&"rr_dataURL"===t){var a=document.createElement("img");a.src=s,a.onload=function(){var e=i.getContext("2d");e&&e.drawImage(a,0,0,a.width,a.height)}}if("rr_width"===t&&(i.style.width=s),"rr_height"===t&&(i.style.height=s),"rr_mediaCurrentTime"===t&&(i.currentTime=e.attributes.rr_mediaCurrentTime),"rr_mediaState"===t)switch(s){case"played":i.play().catch((function(e){return console.warn("media playback error",e)}));break;case"paused":i.pause()}}else{var l="textarea"===o&&"value"===t,u="style"===o&&"_cssText"===t;if(u&&n&&(s=addHoverClass(s)),l||u){for(var c=r.createTextNode(s),f=0,d=Array.from(i.childNodes);f<d.length;f++){var p=d[f];p.nodeType===i.TEXT_NODE&&i.removeChild(p)}return i.appendChild(c),"continue"}try{if(e.isSVG&&"xlink:href"===t)i.setAttributeNS("http://www.w3.org/1999/xlink",t,s);else if("onload"===t||"onclick"===t||"onmouse"===t.substring(0,7))i.setAttribute("_"+t,s);else{if("meta"===o&&"Content-Security-Policy"===e.attributes["http-equiv"]&&"content"===t)return i.setAttribute("csp-content",s),"continue";"link"===o&&"preload"===e.attributes.rel&&"script"===e.attributes.as||"link"===o&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&e.attributes.href.endsWith(".js")||i.setAttribute(t,s)}}catch(e){}}};for(var a in e.attributes)s(a);if(e.isShadowHost)if(i.shadowRoot)for(;i.shadowRoot.firstChild;)i.shadowRoot.removeChild(i.shadowRoot.firstChild);else i.attachShadow({mode:"open"});return i;case NodeType.Text:return r.createTextNode(e.isStyle&&n?addHoverClass(e.textContent):e.textContent);case NodeType.CDATA:return r.createCDATASection(e.textContent);case NodeType.Comment:return r.createComment(e.textContent);default:return null}}function buildNodeWithSN(e,t){var r=t.doc,n=t.map,i=t.skipChild,o=void 0!==i&&i,s=t.hackCss,a=void 0===s||s,l=t.afterAppend,u=buildNode(e,{doc:r,hackCss:a});if(!u)return null;if(e.rootId&&console.assert(n[e.rootId]===r,"Target document should has the same root id."),e.type===NodeType.Document&&(r.close(),r.open(),u=r),u.__sn=e,n[e.id]=u,(e.type===NodeType.Document||e.type===NodeType.Element)&&!o)for(var c=0,f=e.childNodes;c<f.length;c++){var d=f[c],p=buildNodeWithSN(d,{doc:r,map:n,skipChild:!1,hackCss:a,afterAppend:l});p?(d.isShadow&&isElement(u)&&u.shadowRoot?u.shadowRoot.appendChild(p):u.appendChild(p),l&&l(p)):console.warn("Failed to rebuild",d)}return u}function visit(e,t){for(var r in e)e[r]&&(n=e[r],t(n));var n}function handleScroll(e){var t=e.__sn;if(t.type===NodeType.Element){var r=e;for(var n in t.attributes)if(t.attributes.hasOwnProperty(n)&&n.startsWith("rr_")){var i=t.attributes[n];"rr_scrollLeft"===n&&(r.scrollLeft=i),"rr_scrollTop"===n&&(r.scrollTop=i)}}}function rebuild(e,t){var r=t.doc,n=t.onVisit,i=t.hackCss,o={},s=buildNodeWithSN(e,{doc:r,map:o,skipChild:!1,hackCss:void 0===i||i,afterAppend:t.afterAppend});return visit(o,(function(e){n&&n(e),handleScroll(e)})),[s,o]}function createMirror(){return{map:{},getId:function(e){return e.__sn?e.__sn.id:-1},getNode:function(e){return this.map[e]||null},removeNodeFromMap:function(e){var t=this,r=e.__sn&&e.__sn.id;delete this.map[r],e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},has:function(e){return this.map.hasOwnProperty(e)},reset:function(){this.map={}}}}var DEPARTED_MIRROR_ACCESS_WARNING="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.",_mirror={map:{},getId:function(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),-1},getNode:function(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),null},removeNodeFromMap:function(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)},has:function(){return console.error(DEPARTED_MIRROR_ACCESS_WARNING),!1},reset:function(){console.error(DEPARTED_MIRROR_ACCESS_WARNING)}};function polyfill$1(e){void 0===e&&(e=window),"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(e){if(!(0 in arguments))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1})}function needCastInSyncMode(e){switch(e.type){case EventType.DomContentLoaded:case EventType.Load:case EventType.Custom:return!1;case EventType.FullSnapshot:case EventType.Meta:case EventType.Plugin:return!0}switch(e.data.source){case IncrementalSource.MouseMove:case IncrementalSource.MouseInteraction:case IncrementalSource.TouchMove:case IncrementalSource.MediaInteraction:return!1;case IncrementalSource.ViewportResize:case IncrementalSource.StyleSheetRule:case IncrementalSource.Scroll:case IncrementalSource.Input:return!0}return!0}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(_mirror=new Proxy(_mirror,{get:function(e,t,r){return"map"===t&&console.error(DEPARTED_MIRROR_ACCESS_WARNING),Reflect.get(e,t,r)}}));var TreeIndex=function(){function e(){this.reset()}return e.prototype.add=function(e){var t=this.indexes.get(e.parentId),r={id:e.node.id,mutation:e,children:[],texts:[],attributes:[]};t?(r.parent=t,t.children[r.id]=r):this.tree[r.id]=r,this.indexes.set(r.id,r)},e.prototype.remove=function(e,t){var r=this,n=this.indexes.get(e.parentId),i=this.indexes.get(e.id),o=function(e){r.removeIdSet.add(e);var n=t.getNode(e);null==n||n.childNodes.forEach((function(e){"__sn"in e&&o(e.__sn.id)}))},s=function(t){r.removeIdSet.add(t.id),Object.values(t.children).forEach((function(e){return s(e)}));var n=r.indexes.get(t.id);if(n){var i=n.parent;i&&(delete n.parent,delete i.children[n.id],r.indexes.delete(e.id))}};i?n?(delete i.parent,delete n.children[i.id],this.indexes.delete(e.id),s(i)):(delete this.tree[i.id],this.indexes.delete(i.id),s(i)):(this.removeNodeMutations.push(e),o(e.id))},e.prototype.text=function(e){var t=this.indexes.get(e.id);t?t.texts.push(e):this.textMutations.push(e)},e.prototype.attribute=function(e){var t=this.indexes.get(e.id);t?t.attributes.push(e):this.attributeMutations.push(e)},e.prototype.scroll=function(e){this.scrollMap.set(e.id,e)},e.prototype.input=function(e){this.inputMap.set(e.id,e)},e.prototype.flush=function(){var e,t,r,n,i=this,o=this,s=o.tree,a=o.removeNodeMutations,l=o.textMutations,u=o.attributeMutations,c={source:IncrementalSource.Mutation,removes:a,texts:l,attributes:u,adds:[]},f=function(e,t){t&&i.removeIdSet.add(e.id),c.texts=c.texts.concat(t?[]:e.texts).filter((function(e){return!i.removeIdSet.has(e.id)})),c.attributes=c.attributes.concat(t?[]:e.attributes).filter((function(e){return!i.removeIdSet.has(e.id)})),i.removeIdSet.has(e.id)||i.removeIdSet.has(e.mutation.parentId)||t?Object.values(e.children).forEach((function(e){return f(e,!0)})):(c.adds.push(e.mutation),e.children&&Object.values(e.children).forEach((function(e){return f(e,!1)})))};Object.values(s).forEach((function(e){return f(e,!1)}));try{for(var d=__values(this.scrollMap.keys()),p=d.next();!p.done;p=d.next()){var h=p.value;this.removeIdSet.has(h)&&this.scrollMap.delete(h)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(t=d.return)&&t.call(d)}finally{if(e)throw e.error}}try{for(var v=__values(this.inputMap.keys()),m=v.next();!m.done;m=v.next()){h=m.value;this.removeIdSet.has(h)&&this.inputMap.delete(h)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}var y=new Map(this.scrollMap),g=new Map(this.inputMap);return this.reset(),{mutationData:c,scrollMap:y,inputMap:g}},e.prototype.reset=function(){this.tree=[],this.indexes=new Map,this.removeNodeMutations=[],this.textMutations=[],this.attributeMutations=[],this.removeIdSet=new Set,this.scrollMap=new Map,this.inputMap=new Map},e}();function queueToResolveTrees(e){var t,r,n={},i=function(e,t){var r={value:e,parent:t,children:[]};return n[e.node.id]=r,r},o=[];try{for(var s=__values(e),a=s.next();!a.done;a=s.next()){var l=a.value,u=l.nextId,c=l.parentId;if(u&&u in n){var f=n[u];if(f.parent){var d=f.parent.children.indexOf(f);f.parent.children.splice(d,0,i(l,f.parent))}else{d=o.indexOf(f);o.splice(d,0,i(l,null))}}else if(c in n){var p=n[c];p.children.push(i(l,p))}else o.push(i(l,null))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return o}function iterateResolveTree(e,t){t(e.value);for(var r=e.children.length-1;r>=0;r--)iterateResolveTree(e.children[r],t)}function isIframeINode(e){return"__sn"in e&&(e.__sn.type===NodeType.Element&&"iframe"===e.__sn.tagName)}function getBaseDimension(e,t){var r,n,i=null===(n=null===(r=e.ownerDocument)||void 0===r?void 0:r.defaultView)||void 0===n?void 0:n.frameElement;if(!i||i===t)return{x:0,y:0,relativeScale:1,absoluteScale:1};var o=i.getBoundingClientRect(),s=getBaseDimension(i,t),a=o.height/i.clientHeight;return{x:o.x*s.relativeScale+s.x,y:o.y*s.relativeScale+s.y,relativeScale:a,absoluteScale:s.absoluteScale*a}}function hasShadowRoot(e){var t;return Boolean(null===(t=e)||void 0===t?void 0:t.shadowRoot)}function mitt$1(e){return e=e||Object.create(null),{on:function(t,r){(e[t]||(e[t]=[])).push(r)},off:function(t,r){e[t]&&e[t].splice(e[t].indexOf(r)>>>0,1)},emit:function(t,r){(e[t]||[]).slice().map((function(e){e(r)})),(e["*"]||[]).slice().map((function(e){e(t,r)}))}}}var mitt_es=Object.freeze({__proto__:null,default:mitt$1});function polyfill(e,t){if(void 0===e&&(e=window),void 0===t&&(t=document),!("scrollBehavior"in t.documentElement.style)||!0===e.__forceSmoothScrollPolyfill__){var r,n=e.HTMLElement||e.Element,i={scroll:e.scroll||e.scrollTo,scrollBy:e.scrollBy,elementScroll:n.prototype.scroll||a,scrollIntoView:n.prototype.scrollIntoView},o=e.performance&&e.performance.now?e.performance.now.bind(e.performance):Date.now,s=(r=e.navigator.userAgent,new RegExp(["MSIE ","Trident/","Edge/"].join("|")).test(r)?1:0);e.scroll=e.scrollTo=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?h.call(e,t.body,void 0!==arguments[0].left?~~arguments[0].left:e.scrollX||e.pageXOffset,void 0!==arguments[0].top?~~arguments[0].top:e.scrollY||e.pageYOffset):i.scroll.call(e,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:e.scrollX||e.pageXOffset,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:e.scrollY||e.pageYOffset))},e.scrollBy=function(){void 0!==arguments[0]&&(l(arguments[0])?i.scrollBy.call(e,void 0!==arguments[0].left?arguments[0].left:"object"!=typeof arguments[0]?arguments[0]:0,void 0!==arguments[0].top?arguments[0].top:void 0!==arguments[1]?arguments[1]:0):h.call(e,t.body,~~arguments[0].left+(e.scrollX||e.pageXOffset),~~arguments[0].top+(e.scrollY||e.pageYOffset)))},n.prototype.scroll=n.prototype.scrollTo=function(){if(void 0!==arguments[0])if(!0!==l(arguments[0])){var e=arguments[0].left,t=arguments[0].top;h.call(this,this,void 0===e?this.scrollLeft:~~e,void 0===t?this.scrollTop:~~t)}else{if("number"==typeof arguments[0]&&void 0===arguments[1])throw new SyntaxError("Value could not be converted");i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left:"object"!=typeof arguments[0]?~~arguments[0]:this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top:void 0!==arguments[1]?~~arguments[1]:this.scrollTop)}},n.prototype.scrollBy=function(){void 0!==arguments[0]&&(!0!==l(arguments[0])?this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior}):i.elementScroll.call(this,void 0!==arguments[0].left?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,void 0!==arguments[0].top?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop))},n.prototype.scrollIntoView=function(){if(!0!==l(arguments[0])){var r=d(this),n=r.getBoundingClientRect(),o=this.getBoundingClientRect();r!==t.body?(h.call(this,r,r.scrollLeft+o.left-n.left,r.scrollTop+o.top-n.top),"fixed"!==e.getComputedStyle(r).position&&e.scrollBy({left:n.left,top:n.top,behavior:"smooth"})):e.scrollBy({left:o.left,top:o.top,behavior:"smooth"})}else i.scrollIntoView.call(this,void 0===arguments[0]||arguments[0])}}function a(e,t){this.scrollLeft=e,this.scrollTop=t}function l(e){if(null===e||"object"!=typeof e||void 0===e.behavior||"auto"===e.behavior||"instant"===e.behavior)return!0;if("object"==typeof e&&"smooth"===e.behavior)return!1;throw new TypeError("behavior member of ScrollOptions "+e.behavior+" is not a valid value for enumeration ScrollBehavior.")}function u(e,t){return"Y"===t?e.clientHeight+s<e.scrollHeight:"X"===t?e.clientWidth+s<e.scrollWidth:void 0}function c(t,r){var n=e.getComputedStyle(t,null)["overflow"+r];return"auto"===n||"scroll"===n}function f(e){var t=u(e,"Y")&&c(e,"Y"),r=u(e,"X")&&c(e,"X");return t||r}function d(e){for(;e!==t.body&&!1===f(e);)e=e.parentNode||e.host;return e}function p(t){var r,n,i,s,a=(o()-t.startTime)/468;s=a=a>1?1:a,r=.5*(1-Math.cos(Math.PI*s)),n=t.startX+(t.x-t.startX)*r,i=t.startY+(t.y-t.startY)*r,t.method.call(t.scrollable,n,i),n===t.x&&i===t.y||e.requestAnimationFrame(p.bind(e,t))}function h(r,n,s){var l,u,c,f,d=o();r===t.body?(l=e,u=e.scrollX||e.pageXOffset,c=e.scrollY||e.pageYOffset,f=i.scroll):(l=r,u=r.scrollLeft,c=r.scrollTop,f=a),p({scrollable:l,method:f,startTime:d,startX:u,startY:c,x:n,y:s})}}var Timer=function(){function e(e,t){void 0===e&&(e=[]),this.timeOffset=0,this.raf=null,this.actions=e,this.speed=t}return e.prototype.addAction=function(e){var t=this.findActionIndex(e);this.actions.splice(t,0,e)},e.prototype.addActions=function(e){this.actions=this.actions.concat(e)},e.prototype.start=function(){this.timeOffset=0;var e=performance.now(),t=this.actions,r=this;this.raf=requestAnimationFrame((function n(){var i=performance.now();for(r.timeOffset+=(i-e)*r.speed,e=i;t.length;){var o=t[0];if(!(r.timeOffset>=o.delay))break;t.shift(),o.doAction()}(t.length>0||r.liveMode)&&(r.raf=requestAnimationFrame(n))}))},e.prototype.clear=function(){this.raf&&(cancelAnimationFrame(this.raf),this.raf=null),this.actions.length=0},e.prototype.setSpeed=function(e){this.speed=e},e.prototype.toggleLiveMode=function(e){this.liveMode=e},e.prototype.isActive=function(){return null!==this.raf},e.prototype.findActionIndex=function(e){for(var t=0,r=this.actions.length-1;t<=r;){var n=Math.floor((t+r)/2);if(this.actions[n].delay<e.delay)t=n+1;else{if(!(this.actions[n].delay>e.delay))return n;r=n-1}}return t},e}(),t;function addDelay(e,t){if(e.type===EventType.IncrementalSnapshot&&e.data.source===IncrementalSource.MouseMove){var r=e.data.positions[0].timeOffset,n=e.timestamp+r;return e.delay=n-t,n-t}return e.delay=e.timestamp-t,e.delay}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */!function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"}(t||(t={}));var n={type:"xstate.init"};function e(e){return void 0===e?[]:[].concat(e)}function r(e){return{type:"xstate.assign",assignment:e}}function i(e,t){return"string"==typeof(e="string"==typeof e&&t&&t[e]?t[e]:e)?{type:e}:"function"==typeof e?{type:e.name,exec:e}:e}function o(e){return function(t){return e===t}}function a(e){return"string"==typeof e?{type:e}:e}function u(e,t){return{value:e,context:t,actions:[],changed:!1,matches:o(e)}}function c(t,r){void 0===r&&(r={});var n={config:t,_options:r,initialState:{value:t.initial,actions:e(t.states[t.initial].entry).map((function(e){return i(e,r.actions)})),context:t.context,matches:o(t.initial)},transition:function(r,s){var l,c,f="string"==typeof r?{value:r,context:t.context}:r,d=f.value,p=f.context,h=a(s),v=t.states[d];if(v.on){var m=e(v.on[h.type]),y=function(e){if(void 0===e)return{value:u(d,p)};var r="string"==typeof e?{target:e}:e,s=r.target,a=void 0===s?d:s,l=r.actions,c=void 0===l?[]:l,f=r.cond,m=p;if((void 0===f?function(){return!0}:f)(p,h)){var y=t.states[a],g=!1,b=[].concat(v.exit,c,y.entry).filter((function(e){return e})).map((function(e){return i(e,n._options.actions)})).filter((function(e){if("xstate.assign"===e.type){g=!0;var t=Object.assign({},m);return"function"==typeof e.assignment?t=e.assignment(m,h):Object.keys(e.assignment).forEach((function(r){t[r]="function"==typeof e.assignment[r]?e.assignment[r](m,h):e.assignment[r]})),m=t,!1}return!0}));return{value:{value:a,context:m,actions:b,changed:a!==d||b.length>0||g,matches:o(a)}}}};try{for(var g=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}(m),b=g.next();!b.done;b=g.next()){var w=y(b.value);if("object"==typeof w)return w.value}}catch(e){l={error:e}}finally{try{b&&!b.done&&(c=g.return)&&c.call(g)}finally{if(l)throw l.error}}}return u(d,p)}};return n}var s=function(e,t){return e.actions.forEach((function(r){var n=r.exec;return n&&n(e.context,t)}))};function f(e){var r=e.initialState,i=t.NotStarted,l=new Set,u={_machine:e,send:function(n){i===t.Running&&(r=e.transition(r,n),s(r,a(n)),l.forEach((function(e){return e(r)})))},subscribe:function(e){return l.add(e),e(r),{unsubscribe:function(){return l.delete(e)}}},start:function(a){if(a){var l="object"==typeof a?a:{context:e.config.context,value:a};r={value:l.value,actions:[],context:l.context,matches:o(l.value)}}return i=t.Running,s(r,n),u},stop:function(){return i=t.Stopped,l.clear(),u},get state(){return r},get status(){return i}};return u}function discardPriorSnapshots(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r];if(n.type===EventType.Meta&&n.timestamp<=t)return e.slice(r)}return e}function createPlayerService(e,t){var n=t.getCastFn,i=t.emitter;return f(c({id:"player",context:e,initial:"paused",states:{playing:{on:{PAUSE:{target:"paused",actions:["pause"]},CAST_EVENT:{target:"playing",actions:"castEvent"},END:{target:"paused",actions:["resetLastPlayedEvent","pause"]},ADD_EVENT:{target:"playing",actions:["addEvent"]}}},paused:{on:{PLAY:{target:"playing",actions:["recordTimeOffset","play"]},CAST_EVENT:{target:"paused",actions:"castEvent"},TO_LIVE:{target:"live",actions:["startLive"]},ADD_EVENT:{target:"paused",actions:["addEvent"]}}},live:{on:{ADD_EVENT:{target:"live",actions:["addEvent"]},CAST_EVENT:{target:"live",actions:["castEvent"]}}}}},{actions:{castEvent:r({lastPlayedEvent:function(e,t){return"CAST_EVENT"===t.type?t.payload.event:e.lastPlayedEvent}}),recordTimeOffset:r((function(e,t){var r=e.timeOffset;return"payload"in t&&"timeOffset"in t.payload&&(r=t.payload.timeOffset),__assign(__assign({},e),{timeOffset:r,baselineTime:e.events[0].timestamp+r})})),play:function(e){var t,r,o,s,a,l=e.timer,u=e.events,c=e.baselineTime,f=e.lastPlayedEvent;l.clear();try{for(var d=__values(u),p=d.next();!p.done;p=d.next()){addDelay(p.value,c)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}var h=discardPriorSnapshots(u,c),v=null==f?void 0:f.timestamp;(null==f?void 0:f.type)===EventType.IncrementalSnapshot&&f.data.source===IncrementalSource.MouseMove&&(v=f.timestamp+(null===(a=f.data.positions[0])||void 0===a?void 0:a.timeOffset)),c<(v||0)&&i.emit(ReplayerEvents.PlayBack);var m=new Array,y=function(e){if(v&&v<c&&(e.timestamp<=v||e===f))return"continue";var t=e.timestamp<c;if(t&&!needCastInSyncMode(e))return"continue";var r=n(e,t);t?r():m.push({doAction:function(){r(),i.emit(ReplayerEvents.EventCast,e)},delay:e.delay})};try{for(var g=__values(h),b=g.next();!b.done;b=g.next()){y(b.value)}}catch(e){o={error:e}}finally{try{b&&!b.done&&(s=g.return)&&s.call(g)}finally{if(o)throw o.error}}i.emit(ReplayerEvents.Flush),l.addActions(m),l.start()},pause:function(e){e.timer.clear()},resetLastPlayedEvent:r((function(e){return __assign(__assign({},e),{lastPlayedEvent:null})})),startLive:r({baselineTime:function(e,t){return e.timer.toggleLiveMode(!0),e.timer.start(),"TO_LIVE"===t.type&&t.payload.baselineTime?t.payload.baselineTime:Date.now()}}),addEvent:r((function(e,t){var r=e.baselineTime,o=e.timer,s=e.events;if("ADD_EVENT"===t.type){var a=t.payload.event;addDelay(a,r);var l=s.length-1;if(!s[l]||s[l].timestamp<=a.timestamp)s.push(a);else{for(var u=-1,c=0;c<=l;){var f=Math.floor((c+l)/2);s[f].timestamp<=a.timestamp?c=f+1:l=f-1}-1===u&&(u=c),s.splice(u,0,a)}var d=a.timestamp<r,p=n(a,d);d?p():o.isActive()&&o.addAction({doAction:function(){p(),i.emit(ReplayerEvents.EventCast,a)},delay:a.delay})}return __assign(__assign({},e),{events:s})}))}}))}function createSpeedService(e){return f(c({id:"speed",context:e,initial:"normal",states:{normal:{on:{FAST_FORWARD:{target:"skipping",actions:["recordSpeed","setSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}},skipping:{on:{BACK_TO_NORMAL:{target:"normal",actions:["restoreSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}}}},{actions:{setSpeed:function(e,t){"payload"in t&&e.timer.setSpeed(t.payload.speed)},recordSpeed:r({normalSpeed:function(e){return e.timer.speed}}),restoreSpeed:function(e){e.timer.setSpeed(e.normalSpeed)}}}))}var rules=function(e){return["."+e+" { background: #ccc }","noscript { display: none !important; }"]},StyleRuleType;function applyVirtualStyleRulesToNode(e,t){e.forEach((function(e){var r,n;if(e.type===StyleRuleType.Insert)try{null===(r=t.sheet)||void 0===r||r.insertRule(e.cssText,e.index)}catch(e){}else if(e.type===StyleRuleType.Remove)try{null===(n=t.sheet)||void 0===n||n.deleteRule(e.index)}catch(e){}else e.type===StyleRuleType.Snapshot&&restoreSnapshotOfStyleRulesToNode(e.cssTexts,t)}))}function restoreSnapshotOfStyleRulesToNode(e,t){var r;try{var n=Array.from((null===(r=t.sheet)||void 0===r?void 0:r.cssRules)||[]).map((function(e){return e.cssText})),i=Object.entries(n).reverse(),o=n.length;i.forEach((function(r){var n,i=__read(r,2),s=i[0],a=i[1],l=e.indexOf(a);if(-1===l||l>o)try{null===(n=t.sheet)||void 0===n||n.deleteRule(Number(s))}catch(e){}o=l})),e.forEach((function(e,r){var n,i,o;try{(null===(i=null===(n=t.sheet)||void 0===n?void 0:n.cssRules[r])||void 0===i?void 0:i.cssText)!==e&&(null===(o=t.sheet)||void 0===o||o.insertRule(e,r))}catch(e){}}))}catch(e){}}function storeCSSRules(e,t){var r;try{var n=Array.from((null===(r=e.sheet)||void 0===r?void 0:r.cssRules)||[]).map((function(e){return e.cssText}));t.set(e,[{type:StyleRuleType.Snapshot,cssTexts:n}])}catch(e){}}!function(e){e[e.Insert=0]="Insert",e[e.Remove=1]="Remove",e[e.Snapshot=2]="Snapshot"}(StyleRuleType||(StyleRuleType={}));var SKIP_TIME_THRESHOLD=1e4,SKIP_TIME_INTERVAL=5e3,mitt=mitt$1||mitt_es,REPLAY_CONSOLE_PREFIX="[replayer]",defaultMouseTailConfig={duration:500,lineCap:"round",lineWidth:3,strokeStyle:"red"},Replayer=function(){function e(e,t){var r=this;if(this.mouseTail=null,this.tailPositions=[],this.emitter=mitt(),this.legacy_missingNodeRetryMap={},this.imageMap=new Map,this.mirror=createMirror(),this.firstFullSnapshot=null,this.newDocumentQueue=[],!(null==t?void 0:t.liveMode)&&e.length<2)throw new Error("Replayer need at least 2 events.");var n={speed:1,maxSpeed:360,root:document.body,loadTimeout:0,skipInactive:!1,showWarning:!0,showDebug:!1,blockClass:"rr-block",liveMode:!1,insertStyleRules:[],triggerFocus:!0,UNSAFE_replayCanvas:!1,pauseAnimation:!0,mouseTail:defaultMouseTailConfig};this.config=Object.assign({},n,t),this.handleResize=this.handleResize.bind(this),this.getCastFn=this.getCastFn.bind(this),this.emitter.on(ReplayerEvents.Resize,this.handleResize),this.setupDom(),this.treeIndex=new TreeIndex,this.fragmentParentMap=new Map,this.elementStateMap=new Map,this.virtualStyleRulesMap=new Map,this.emitter.on(ReplayerEvents.Flush,(function(){var e,t,n,i,o,s,a=r.treeIndex.flush(),l=a.scrollMap,u=a.inputMap;r.fragmentParentMap.forEach((function(e,t){return r.restoreRealParent(t,e)}));try{for(var c=__values(r.virtualStyleRulesMap.keys()),f=c.next();!f.done;f=c.next()){var d=f.value;r.restoreNodeSheet(d)}}catch(t){e={error:t}}finally{try{f&&!f.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}r.fragmentParentMap.clear(),r.elementStateMap.clear(),r.virtualStyleRulesMap.clear();try{for(var p=__values(l.values()),h=p.next();!h.done;h=p.next()){var v=h.value;r.applyScroll(v)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}try{for(var m=__values(u.values()),y=m.next();!y.done;y=m.next()){v=y.value;r.applyInput(v)}}catch(e){o={error:e}}finally{try{y&&!y.done&&(s=m.return)&&s.call(m)}finally{if(o)throw o.error}}})),this.emitter.on(ReplayerEvents.PlayBack,(function(){r.firstFullSnapshot=null,r.mirror.reset()}));var i=new Timer([],(null==t?void 0:t.speed)||n.speed);this.service=createPlayerService({events:e.map((function(e){return t&&t.unpackFn?t.unpackFn(e):e})).sort((function(e,t){return e.timestamp-t.timestamp})),timer:i,timeOffset:0,baselineTime:0,lastPlayedEvent:null},{getCastFn:this.getCastFn,emitter:this.emitter}),this.service.start(),this.service.subscribe((function(e){r.emitter.emit(ReplayerEvents.StateChange,{player:e})})),this.speedService=createSpeedService({normalSpeed:-1,timer:i}),this.speedService.start(),this.speedService.subscribe((function(e){r.emitter.emit(ReplayerEvents.StateChange,{speed:e})}));var o=this.service.state.context.events.find((function(e){return e.type===EventType.Meta})),s=this.service.state.context.events.find((function(e){return e.type===EventType.FullSnapshot}));if(o){var a=o.data,l=a.width,u=a.height;setTimeout((function(){r.emitter.emit(ReplayerEvents.Resize,{width:l,height:u})}),0)}s&&setTimeout((function(){r.firstFullSnapshot||(r.firstFullSnapshot=s,r.rebuildFullSnapshot(s),r.iframe.contentWindow.scrollTo(s.data.initialOffset))}),1)}return Object.defineProperty(e.prototype,"timer",{get:function(){return this.service.state.context.timer},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t){return this.emitter.on(e,t),this},e.prototype.off=function(e,t){return this.emitter.off(e,t),this},e.prototype.setConfig=function(e){var t=this;Object.keys(e).forEach((function(r){t.config[r]=e[r]})),this.config.skipInactive||this.backToNormal(),void 0!==e.speed&&this.speedService.send({type:"SET_SPEED",payload:{speed:e.speed}}),void 0!==e.mouseTail&&(!1===e.mouseTail?this.mouseTail&&(this.mouseTail.style.display="none"):(this.mouseTail||(this.mouseTail=document.createElement("canvas"),this.mouseTail.width=Number.parseFloat(this.iframe.width),this.mouseTail.height=Number.parseFloat(this.iframe.height),this.mouseTail.classList.add("replayer-mouse-tail"),this.wrapper.insertBefore(this.mouseTail,this.iframe)),this.mouseTail.style.display="inherit"))},e.prototype.getMetaData=function(){var e=this.service.state.context.events[0],t=this.service.state.context.events[this.service.state.context.events.length-1];return{startTime:e.timestamp,endTime:t.timestamp,totalTime:t.timestamp-e.timestamp}},e.prototype.getCurrentTime=function(){return this.timer.timeOffset+this.getTimeOffset()},e.prototype.getTimeOffset=function(){var e=this.service.state.context;return e.baselineTime-e.events[0].timestamp},e.prototype.getMirror=function(){return this.mirror},e.prototype.play=function(e){var t;void 0===e&&(e=0),this.service.state.matches("paused")||this.service.send({type:"PAUSE"}),this.service.send({type:"PLAY",payload:{timeOffset:e}}),null===(t=this.iframe.contentDocument)||void 0===t||t.getElementsByTagName("html")[0].classList.remove("rrweb-paused"),this.emitter.emit(ReplayerEvents.Start)},e.prototype.pause=function(e){var t;void 0===e&&this.service.state.matches("playing")&&this.service.send({type:"PAUSE"}),"number"==typeof e&&(this.play(e),this.service.send({type:"PAUSE"})),null===(t=this.iframe.contentDocument)||void 0===t||t.getElementsByTagName("html")[0].classList.add("rrweb-paused"),this.emitter.emit(ReplayerEvents.Pause)},e.prototype.resume=function(e){void 0===e&&(e=0),console.warn("The 'resume' will be departed in 1.0. Please use 'play' method which has the same interface."),this.play(e),this.emitter.emit(ReplayerEvents.Resume)},e.prototype.startLive=function(e){this.service.send({type:"TO_LIVE",payload:{baselineTime:e}})},e.prototype.addEvent=function(e){var t=this,r=this.config.unpackFn?this.config.unpackFn(e):e;Promise.resolve().then((function(){return t.service.send({type:"ADD_EVENT",payload:{event:r}})}))},e.prototype.enableInteract=function(){this.iframe.setAttribute("scrolling","auto"),this.iframe.style.pointerEvents="auto"},e.prototype.disableInteract=function(){this.iframe.setAttribute("scrolling","no"),this.iframe.style.pointerEvents="none"},e.prototype.setupDom=function(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("replayer-wrapper"),this.config.root.appendChild(this.wrapper),this.mouse=document.createElement("div"),this.mouse.classList.add("replayer-mouse"),this.wrapper.appendChild(this.mouse),!1!==this.config.mouseTail&&(this.mouseTail=document.createElement("canvas"),this.mouseTail.classList.add("replayer-mouse-tail"),this.mouseTail.style.display="inherit",this.wrapper.appendChild(this.mouseTail)),this.iframe=document.createElement("iframe");var e=["allow-same-origin"];this.config.UNSAFE_replayCanvas&&e.push("allow-scripts"),this.iframe.style.display="none",this.iframe.setAttribute("sandbox",e.join(" ")),this.disableInteract(),this.wrapper.appendChild(this.iframe),this.iframe.contentWindow&&this.iframe.contentDocument&&(polyfill(this.iframe.contentWindow,this.iframe.contentDocument),polyfill$1(this.iframe.contentWindow))},e.prototype.handleResize=function(e){var t,r;this.iframe.style.display="inherit";try{for(var n=__values([this.mouseTail,this.iframe]),i=n.next();!i.done;i=n.next()){var o=i.value;o&&(o.setAttribute("width",String(e.width)),o.setAttribute("height",String(e.height)))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.getCastFn=function(e,t){var r,n=this;switch(void 0===t&&(t=!1),e.type){case EventType.DomContentLoaded:case EventType.Load:break;case EventType.Custom:r=function(){n.emitter.emit(ReplayerEvents.CustomEvent,e)};break;case EventType.Meta:r=function(){return n.emitter.emit(ReplayerEvents.Resize,{width:e.data.width,height:e.data.height})};break;case EventType.FullSnapshot:r=function(){if(n.firstFullSnapshot){if(n.firstFullSnapshot===e)return void(n.firstFullSnapshot=!0)}else n.firstFullSnapshot=!0;n.rebuildFullSnapshot(e,t),n.iframe.contentWindow.scrollTo(e.data.initialOffset)};break;case EventType.IncrementalSnapshot:r=function(){var r,i;if(n.applyIncremental(e,t),!t&&(e===n.nextUserInteractionEvent&&(n.nextUserInteractionEvent=null,n.backToNormal()),n.config.skipInactive&&!n.nextUserInteractionEvent)){try{for(var o=__values(n.service.state.context.events),s=o.next();!s.done;s=o.next()){var a=s.value;if(!(a.timestamp<=e.timestamp)&&n.isUserInteraction(a)){a.delay-e.delay>SKIP_TIME_THRESHOLD*n.speedService.state.context.timer.speed&&(n.nextUserInteractionEvent=a);break}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}if(n.nextUserInteractionEvent){var l=n.nextUserInteractionEvent.delay-e.delay,u={speed:Math.min(Math.round(l/SKIP_TIME_INTERVAL),n.config.maxSpeed)};n.speedService.send({type:"FAST_FORWARD",payload:u}),n.emitter.emit(ReplayerEvents.SkipStart,u)}}}}return function(){var i,o;r&&r();try{for(var s=__values(n.config.plugins||[]),a=s.next();!a.done;a=s.next()){a.value.handler(e,t,{replayer:n})}}catch(e){i={error:e}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}n.service.send({type:"CAST_EVENT",payload:{event:e}});var l=n.service.state.context.events.length-1;if(e===n.service.state.context.events[l]){var u=function(){l<n.service.state.context.events.length-1||(n.backToNormal(),n.service.send("END"),n.emitter.emit(ReplayerEvents.Finish))};e.type===EventType.IncrementalSnapshot&&e.data.source===IncrementalSource.MouseMove&&e.data.positions.length?setTimeout((function(){u()}),Math.max(0,50-e.data.positions[0].timeOffset)):u()}}},e.prototype.rebuildFullSnapshot=function(e,t){var r,n,i=this;if(void 0===t&&(t=!1),!this.iframe.contentDocument)return console.warn("Looks like your replayer has been destroyed.");Object.keys(this.legacy_missingNodeRetryMap).length&&console.warn("Found unresolved missing node map",this.legacy_missingNodeRetryMap),this.legacy_missingNodeRetryMap={};var o=[];this.mirror.map=rebuild(e.data.node,{doc:this.iframe.contentDocument,afterAppend:function(e){i.collectIframeAndAttachDocument(o,e)}})[1];var s=function(e,t){if(a.attachDocumentToIframe(e,t),a.newDocumentQueue=a.newDocumentQueue.filter((function(t){return t!==e})),t.contentDocument){var r=t.contentDocument,n=r.documentElement,i=r.head;a.insertStyleRules(n,i)}},a=this;try{for(var l=__values(o),u=l.next();!u.done;u=l.next()){var c=u.value;s(c.mutationInQueue,c.builtNode)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}var f=this.iframe.contentDocument,d=f.documentElement,p=f.head;this.insertStyleRules(d,p),this.service.state.matches("playing")||this.iframe.contentDocument.getElementsByTagName("html")[0].classList.add("rrweb-paused"),this.emitter.emit(ReplayerEvents.FullsnapshotRebuilded,e),t||this.waitForStylesheetLoad(),this.config.UNSAFE_replayCanvas&&this.preloadAllImages()},e.prototype.insertStyleRules=function(e,t){var r=document.createElement("style");e.insertBefore(r,t);var n=rules(this.config.blockClass).concat(this.config.insertStyleRules);this.config.pauseAnimation&&n.push("html.rrweb-paused * { animation-play-state: paused !important; }");for(var i=0;i<n.length;i++)r.sheet.insertRule(n[i],i)},e.prototype.attachDocumentToIframe=function(e,t){var r,n,i=this,o=[];if(!t.contentDocument)for(var s=t.parentNode;s;){if(this.fragmentParentMap.has(s)){var a=s,l=this.fragmentParentMap.get(a);this.restoreRealParent(a,l);break}s=s.parentNode}buildNodeWithSN(e.node,{doc:t.contentDocument,map:this.mirror.map,hackCss:!0,skipChild:!1,afterAppend:function(e){i.collectIframeAndAttachDocument(o,e)}});var u=function(e,t){if(c.attachDocumentToIframe(e,t),c.newDocumentQueue=c.newDocumentQueue.filter((function(t){return t!==e})),t.contentDocument){var r=t.contentDocument,n=r.documentElement,i=r.head;c.insertStyleRules(n,i)}},c=this;try{for(var f=__values(o),d=f.next();!d.done;d=f.next()){var p=d.value;u(p.mutationInQueue,p.builtNode)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}},e.prototype.collectIframeAndAttachDocument=function(e,t){if(isIframeINode(t)){var r=this.newDocumentQueue.find((function(e){return e.parentId===t.__sn.id}));r&&e.push({mutationInQueue:r,builtNode:t})}},e.prototype.waitForStylesheetLoad=function(){var e,t=this,r=null===(e=this.iframe.contentDocument)||void 0===e?void 0:e.head;if(r){var n,i=new Set,o=this.service.state,s=function(){o=t.service.state};this.emitter.on(ReplayerEvents.Start,s),this.emitter.on(ReplayerEvents.Pause,s);var a=function(){t.emitter.off(ReplayerEvents.Start,s),t.emitter.off(ReplayerEvents.Pause,s)};r.querySelectorAll('link[rel="stylesheet"]').forEach((function(e){e.sheet||(i.add(e),e.addEventListener("load",(function(){i.delete(e),0===i.size&&-1!==n&&(o.matches("playing")&&t.play(t.getCurrentTime()),t.emitter.emit(ReplayerEvents.LoadStylesheetEnd),n&&window.clearTimeout(n),a())})))})),i.size>0&&(this.service.send({type:"PAUSE"}),this.emitter.emit(ReplayerEvents.LoadStylesheetStart),n=window.setTimeout((function(){o.matches("playing")&&t.play(t.getCurrentTime()),n=-1,a()}),this.config.loadTimeout))}},e.prototype.preloadAllImages=function(){var e,t,r=this;this.service.state;var n=function(){r.service.state};this.emitter.on(ReplayerEvents.Start,n),this.emitter.on(ReplayerEvents.Pause,n);var i=0;try{for(var o=__values(this.service.state.context.events),s=o.next();!s.done;s=o.next()){var a=s.value;if(a.type===EventType.IncrementalSnapshot&&a.data.source===IncrementalSource.CanvasMutation&&"drawImage"===a.data.property&&"string"==typeof a.data.args[0]&&!this.imageMap.has(a)){i++;var l=document.createElement("canvas"),u=l.getContext("2d"),c=null==u?void 0:u.createImageData(l.width,l.height);null==c||c.data;JSON.parse(a.data.args[0]),null==u||u.putImageData(c,0,0)}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}0!==i&&this.service.send({type:"PAUSE"})},e.prototype.applyIncremental=function(e,t){var r,n,i=this,o=e.data;switch(o.source){case IncrementalSource.Mutation:t&&(o.adds.forEach((function(e){return i.treeIndex.add(e)})),o.texts.forEach((function(e){return i.treeIndex.text(e)})),o.attributes.forEach((function(e){return i.treeIndex.attribute(e)})),o.removes.forEach((function(e){return i.treeIndex.remove(e,i.mirror)})));try{this.applyMutation(o,t)}catch(e){this.warn("Exception in mutation "+(e.message||e),o)}break;case IncrementalSource.Drag:case IncrementalSource.TouchMove:case IncrementalSource.MouseMove:if(t){var s=o.positions[o.positions.length-1];this.moveAndHover(o,s.x,s.y,s.id)}else o.positions.forEach((function(t){var r={doAction:function(){i.moveAndHover(o,t.x,t.y,t.id)},delay:t.timeOffset+e.timestamp-i.service.state.context.baselineTime};i.timer.addAction(r)})),this.timer.addAction({doAction:function(){},delay:e.delay-(null===(r=o.positions[0])||void 0===r?void 0:r.timeOffset)});break;case IncrementalSource.MouseInteraction:if(-1===o.id)break;var a=new Event(MouseInteractions[o.type].toLowerCase());if(!(v=this.mirror.getNode(o.id)))return this.debugNodeNotFound(o,o.id);this.emitter.emit(ReplayerEvents.MouseInteraction,{type:o.type,target:v});var l=this.config.triggerFocus;switch(o.type){case MouseInteractions.Blur:"blur"in v&&v.blur();break;case MouseInteractions.Focus:l&&v.focus&&v.focus({preventScroll:!0});break;case MouseInteractions.Click:case MouseInteractions.TouchStart:case MouseInteractions.TouchEnd:t||(this.moveAndHover(o,o.x,o.y,o.id),this.mouse.classList.remove("active"),this.mouse.offsetWidth,this.mouse.classList.add("active"));break;default:v.dispatchEvent(a)}break;case IncrementalSource.Scroll:if(-1===o.id)break;if(t){this.treeIndex.scroll(o);break}this.applyScroll(o);break;case IncrementalSource.ViewportResize:this.emitter.emit(ReplayerEvents.Resize,{width:o.width,height:o.height});break;case IncrementalSource.Input:if(-1===o.id)break;if(t){this.treeIndex.input(o);break}this.applyInput(o);break;case IncrementalSource.MediaInteraction:if(!(v=this.mirror.getNode(o.id)))return this.debugNodeNotFound(o,o.id);var u=v;try{o.currentTime&&(u.currentTime=o.currentTime),o.type===MediaInteractions.Pause&&u.pause(),o.type===MediaInteractions.Play&&u.play()}catch(e){this.config.showWarning&&console.warn("Failed to replay media interactions: "+(e.message||e))}break;case IncrementalSource.StyleSheetRule:if(!(v=this.mirror.getNode(o.id)))return this.debugNodeNotFound(o,o.id);var c,f=v,d=v.parentNode,p=this.fragmentParentMap.has(d),h=p?null:f.sheet;h||(this.virtualStyleRulesMap.has(v)?c=this.virtualStyleRulesMap.get(v):(c=[],this.virtualStyleRulesMap.set(v,c))),o.adds&&o.adds.forEach((function(e){var t=e.rule,r=e.index;if(h)try{var n=void 0===r?void 0:Math.min(r,h.cssRules.length);try{h.insertRule(t,n)}catch(e){}}catch(e){}else null==c||c.push({cssText:t,index:r,type:StyleRuleType.Insert})})),o.removes&&o.removes.forEach((function(e){var t=e.index;if(p)null==c||c.push({index:t,type:StyleRuleType.Remove});else try{null==h||h.deleteRule(t)}catch(e){}}));break;case IncrementalSource.CanvasMutation:if(!this.config.UNSAFE_replayCanvas)return;var v;if(!(v=this.mirror.getNode(o.id)))return this.debugNodeNotFound(o,o.id);try{var m=v.getContext("2d");if(o.setter)return void(m[o.property]=o.args[0]);var y=m[o.property];if("drawImage"===o.property&&"string"==typeof o.args[0]){var g=this.imageMap.get(e);o.args[0]=g,y.apply(m,o.args)}else y.apply(m,o.args)}catch(e){this.warnCanvasMutationFailed(o,o.id,e)}break;case IncrementalSource.Font:try{var b=new FontFace(o.family,o.buffer?new Uint8Array(JSON.parse(o.fontSource)):o.fontSource,o.descriptors);null===(n=this.iframe.contentDocument)||void 0===n||n.fonts.add(b)}catch(e){this.config.showWarning&&console.warn(e)}}},e.prototype.applyMutation=function(e,t){var r,n,i=this;e.removes.forEach((function(t){var r=i.mirror.getNode(t.id);if(!r){if(e.removes.find((function(e){return e.id===t.parentId})))return;return i.warnNodeNotFound(e,t.id)}var n=i.mirror.getNode(t.parentId);if(!n)return i.warnNodeNotFound(e,t.parentId);if(t.isShadow&&hasShadowRoot(n)&&(n=n.shadowRoot),i.mirror.removeNodeFromMap(r),n){var o=null,s="__sn"in n?i.fragmentParentMap.get(n):void 0;s&&s.contains(r)?n=s:i.fragmentParentMap.has(r)&&(o=i.fragmentParentMap.get(r),i.fragmentParentMap.delete(r),r=o);try{n.removeChild(r)}catch(t){if(!(t instanceof DOMException))throw t;i.warn("parent could not remove child in mutation",n,s,r,o,e)}}}));var o=__assign({},this.legacy_missingNodeRetryMap),s=[],a=function(e){var r,n;if(!i.iframe.contentDocument)return console.warn("Looks like your replayer has been destroyed.");var a=i.mirror.getNode(e.parentId);if(!a)return e.node.type===NodeType.Document?i.newDocumentQueue.push(e):s.push(e);var l=null;i.iframe.contentDocument.contains?l=i.iframe.contentDocument.contains(a):i.iframe.contentDocument.body.contains&&(l=i.iframe.contentDocument.body.contains(a));var u=(null===(n=(r=a).getElementsByTagName)||void 0===n?void 0:n.call(r,"iframe").length)>0;if(t&&l&&!isIframeINode(a)&&!u){var c=document.createDocumentFragment();for(i.mirror.map[e.parentId]=c,i.fragmentParentMap.set(c,a),i.storeState(a);a.firstChild;)c.appendChild(a.firstChild);a=c}e.node.isShadow&&hasShadowRoot(a)&&(a=a.shadowRoot);var f=null,d=null;if(e.previousId&&(f=i.mirror.getNode(e.previousId)),e.nextId&&(d=i.mirror.getNode(e.nextId)),function(e){var t=null;return e.nextId&&(t=i.mirror.getNode(e.nextId)),null!==e.nextId&&void 0!==e.nextId&&-1!==e.nextId&&!t}(e))return s.push(e);if(!e.node.rootId||i.mirror.getNode(e.node.rootId)){var p=e.node.rootId?i.mirror.getNode(e.node.rootId):i.iframe.contentDocument;if(isIframeINode(a))i.attachDocumentToIframe(e,a);else{var h=buildNodeWithSN(e.node,{doc:p,map:i.mirror.map,skipChild:!0,hackCss:!0});if(-1!==e.previousId&&-1!==e.nextId){if(f&&f.nextSibling&&f.nextSibling.parentNode)a.insertBefore(h,f.nextSibling);else if(d&&d.parentNode)a.contains(d)?a.insertBefore(h,d):a.insertBefore(h,null);else{if(a===p)for(;p.firstChild;)p.removeChild(p.firstChild);a.appendChild(h)}if(isIframeINode(h)){var v=i.newDocumentQueue.find((function(e){return e.parentId===h.__sn.id}));if(v&&(i.attachDocumentToIframe(v,h),i.newDocumentQueue=i.newDocumentQueue.filter((function(e){return e!==v}))),h.contentDocument){var m=h.contentDocument,y=m.documentElement,g=m.head;i.insertStyleRules(y,g)}}(e.previousId||e.nextId)&&i.legacy_resolveMissingNode(o,a,h,e)}else o[e.node.id]={node:h,mutation:e}}}};e.adds.forEach((function(e){a(e)}));for(var l=Date.now();s.length;){var u=queueToResolveTrees(s);if(s.length=0,Date.now()-l>500){this.warn("Timeout in the loop, please check the resolve tree data:",u);break}try{for(var c=(r=void 0,__values(u)),f=c.next();!f.done;f=c.next()){var d=f.value;this.mirror.getNode(d.value.parentId)?iterateResolveTree(d,(function(e){a(e)})):this.debug("Drop resolve tree since there is no parent for the root node.",d)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}Object.keys(o).length&&Object.assign(this.legacy_missingNodeRetryMap,o),e.texts.forEach((function(t){var r=i.mirror.getNode(t.id);if(!r){if(e.removes.find((function(e){return e.id===t.id})))return;return i.warnNodeNotFound(e,t.id)}i.fragmentParentMap.has(r)&&(r=i.fragmentParentMap.get(r)),r.textContent=t.value})),e.attributes.forEach((function(t){var r=i.mirror.getNode(t.id);if(!r){if(e.removes.find((function(e){return e.id===t.id})))return;return i.warnNodeNotFound(e,t.id)}for(var n in i.fragmentParentMap.has(r)&&(r=i.fragmentParentMap.get(r)),t.attributes)if("string"==typeof n){var o=t.attributes[n];if(null===o)r.removeAttribute(n);else if("string"==typeof o)try{r.setAttribute(n,o)}catch(e){i.config.showWarning&&console.warn("An error occurred may due to the checkout feature.",e)}else if("style"===n){var s=o,a=r;for(var l in s)if(!1===s[l])a.style.removeProperty(l);else if(s[l]instanceof Array){var u=s[l];a.style.setProperty(l,u[0],u[1])}else{var c=s[l];a.style.setProperty(l,c)}}}}))},e.prototype.applyScroll=function(e){var t=this.mirror.getNode(e.id);if(!t)return this.debugNodeNotFound(e,e.id);if(t===this.iframe.contentDocument)this.iframe.contentWindow.scrollTo({top:e.y,left:e.x,behavior:"smooth"});else try{t.scrollTop=e.y,t.scrollLeft=e.x}catch(e){}},e.prototype.applyInput=function(e){var t=this.mirror.getNode(e.id);if(!t)return this.debugNodeNotFound(e,e.id);try{t.checked=e.isChecked,t.value=e.text}catch(e){}},e.prototype.legacy_resolveMissingNode=function(e,t,r,n){var i=n.previousId,o=n.nextId,s=i&&e[i],a=o&&e[o];if(s){var l=s,u=l.node,c=l.mutation;t.insertBefore(u,r),delete e[c.node.id],delete this.legacy_missingNodeRetryMap[c.node.id],(c.previousId||c.nextId)&&this.legacy_resolveMissingNode(e,t,u,c)}if(a){var f=a;u=f.node,c=f.mutation;t.insertBefore(u,r.nextSibling),delete e[c.node.id],delete this.legacy_missingNodeRetryMap[c.node.id],(c.previousId||c.nextId)&&this.legacy_resolveMissingNode(e,t,u,c)}},e.prototype.moveAndHover=function(e,t,r,n){var i=this.mirror.getNode(n);if(!i)return this.debugNodeNotFound(e,n);var o=getBaseDimension(i,this.iframe),s=t*o.absoluteScale+o.x,a=r*o.absoluteScale+o.y;this.mouse.style.left=s+"px",this.mouse.style.top=a+"px",this.drawMouseTail({x:s,y:a}),this.hoverElements(i)},e.prototype.drawMouseTail=function(e){var t=this;if(this.mouseTail){var r=!0===this.config.mouseTail?defaultMouseTailConfig:Object.assign({},defaultMouseTailConfig,this.config.mouseTail),n=r.lineCap,i=r.lineWidth,o=r.strokeStyle,s=r.duration,a=function(){if(t.mouseTail){var e=t.mouseTail.getContext("2d");e&&t.tailPositions.length&&(e.clearRect(0,0,t.mouseTail.width,t.mouseTail.height),e.beginPath(),e.lineWidth=i,e.lineCap=n,e.strokeStyle=o,e.moveTo(t.tailPositions[0].x,t.tailPositions[0].y),t.tailPositions.forEach((function(t){return e.lineTo(t.x,t.y)})),e.stroke())}};this.tailPositions.push(e),a(),setTimeout((function(){t.tailPositions=t.tailPositions.filter((function(t){return t!==e})),a()}),s/this.speedService.state.context.timer.speed)}},e.prototype.hoverElements=function(e){var t;null===(t=this.iframe.contentDocument)||void 0===t||t.querySelectorAll(".\\:hover").forEach((function(e){e.classList.remove(":hover")}));for(var r=e;r;)r.classList&&r.classList.add(":hover"),r=r.parentElement},e.prototype.isUserInteraction=function(e){return e.type===EventType.IncrementalSnapshot&&(e.data.source>IncrementalSource.Mutation&&e.data.source<=IncrementalSource.Input)},e.prototype.backToNormal=function(){this.nextUserInteractionEvent=null,this.speedService.state.matches("normal")||(this.speedService.send({type:"BACK_TO_NORMAL"}),this.emitter.emit(ReplayerEvents.SkipEnd,{speed:this.speedService.state.context.normalSpeed}))},e.prototype.restoreRealParent=function(e,t){this.mirror.map[t.__sn.id]=t,t.__sn.type===NodeType.Element&&"textarea"===t.__sn.tagName&&e.textContent&&(t.value=e.textContent),t.appendChild(e),this.restoreState(t)},e.prototype.storeState=function(e){var t,r;if(e&&e.nodeType===e.ELEMENT_NODE){var n=e;(n.scrollLeft||n.scrollTop)&&this.elementStateMap.set(e,{scroll:[n.scrollLeft,n.scrollTop]}),"STYLE"===n.tagName&&storeCSSRules(n,this.virtualStyleRulesMap);var i=n.children;try{for(var o=__values(Array.from(i)),s=o.next();!s.done;s=o.next()){var a=s.value;this.storeState(a)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}}},e.prototype.restoreState=function(e){var t,r;if(e.nodeType===e.ELEMENT_NODE){var n=e;if(this.elementStateMap.has(e)){var i=this.elementStateMap.get(e);i.scroll&&(n.scrollLeft=i.scroll[0],n.scrollTop=i.scroll[1]),this.elementStateMap.delete(e)}var o=n.children;try{for(var s=__values(Array.from(o)),a=s.next();!a.done;a=s.next()){var l=a.value;this.restoreState(l)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}}},e.prototype.restoreNodeSheet=function(e){var t=this.virtualStyleRulesMap.get(e);"STYLE"===e.nodeName&&(t&&applyVirtualStyleRulesToNode(t,e))},e.prototype.warnNodeNotFound=function(e,t){this.treeIndex.removeIdSet.has(t)?this.warn("Node with id '"+t+"' was previously removed. ",e):this.warn("Node with id '"+t+"' not found. ",e)},e.prototype.warnCanvasMutationFailed=function(e,t,r){this.warn("Has error on update canvas '"+t+"'",e,r)},e.prototype.debugNodeNotFound=function(e,t){this.treeIndex.removeIdSet.has(t)?this.debug(REPLAY_CONSOLE_PREFIX,"Node with id '"+t+"' was previously removed. ",e):this.debug(REPLAY_CONSOLE_PREFIX,"Node with id '"+t+"' not found. ",e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.config.showWarning&&console.warn.apply(console,__spread([REPLAY_CONSOLE_PREFIX],e))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.config.showDebug&&console.log.apply(console,__spread([REPLAY_CONSOLE_PREFIX],e))},e}(),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},indexMinimal={},minimal$1={},aspromise=asPromise;function asPromise(e,t){for(var r=new Array(arguments.length-1),n=0,i=2,o=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,s){r[n]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,s(e))}}))}var base64$1={};!function(e){var t=base64$1;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var r=new Array(64),n=new Array(123),i=0;i<64;)n[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;t.encode=function(e,t,n){for(var i,o=null,s=[],a=0,l=0;t<n;){var u=e[t++];switch(l){case 0:s[a++]=r[u>>2],i=(3&u)<<4,l=1;break;case 1:s[a++]=r[i|u>>4],i=(15&u)<<2,l=2;break;case 2:s[a++]=r[i|u>>6],s[a++]=r[63&u],l=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return l&&(s[a++]=r[i],s[a++]=61,1===l&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};var o="invalid encoding";t.decode=function(e,t,r){for(var i,s=r,a=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&a>1)break;if(void 0===(u=n[u]))throw Error(o);switch(a){case 0:i=u,a=1;break;case 1:t[r++]=i<<2|(48&u)>>4,i=u,a=2;break;case 2:t[r++]=(15&i)<<4|(60&u)>>2,i=u,a=3;break;case 3:t[r++]=(3&i)<<6|u,a=0}}if(1===a)throw Error(o);return r-s},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}();var eventemitter=EventEmitter;function EventEmitter(){this._listeners={}}EventEmitter.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},EventEmitter.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},EventEmitter.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this};var float=factory(factory);function factory(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?s:a,e.readFloatBE=n?a:s}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,s=8388607&n;return 255===o?s?NaN:i*(1/0):0===o?1401298464324817e-60*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,writeUintLE),e.writeFloatBE=t.bind(null,writeUintBE),e.readFloatLE=r.bind(null,readUintLE),e.readFloatBE=r.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?s:a,e.readDoubleBE=n?a:s}():function(){function t(e,t,r,n,i,o){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>17976931348623157e292)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=n*Math.pow(2,-l))>>>0,i,o+t),e((s<<31|l+1023<<20|1048576*a&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),s=e(n,i+r),a=2*(s>>31)+1,l=s>>>20&2047,u=4294967296*(1048575&s)+o;return 2047===l?u?NaN:a*(1/0):0===l?5e-324*a*u:a*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,writeUintLE,0,4),e.writeDoubleBE=t.bind(null,writeUintBE,4,0),e.readDoubleLE=r.bind(null,readUintLE,0,4),e.readDoubleBE=r.bind(null,readUintBE,4,0)}(),e}function writeUintLE(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function writeUintBE(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function readUintLE(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function readUintBE(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}var inquire_1=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}var utf8$2={};!function(e){var t=utf8$2;t.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],s=0;t<r;)(n=e[t++])<128?o[s++]=n:n>191&&n<224?o[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(n>>10),o[s++]=56320+(1023&n)):o[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},t.write=function(e,t,r){for(var n,i,o=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}}();var pool_1=pool;function pool(e,t,r){var n=r||8192,i=n>>>1,o=null,s=n;return function(r){if(r<1||r>i)return e(r);s+r>n&&(o=e(n),s=0);var a=t.call(o,s,s+=r);return 7&s&&(s=1+(7|s)),a}}var longbits=LongBits$2,util$5=minimal$1;function LongBits$2(e,t){this.lo=e>>>0,this.hi=t>>>0}var zero=LongBits$2.zero=new LongBits$2(0,0);zero.toNumber=function(){return 0},zero.zzEncode=zero.zzDecode=function(){return this},zero.length=function(){return 1};var zeroHash=LongBits$2.zeroHash="\0\0\0\0\0\0\0\0";LongBits$2.fromNumber=function(e){if(0===e)return zero;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new LongBits$2(r,n)},LongBits$2.from=function(e){if("number"==typeof e)return LongBits$2.fromNumber(e);if(util$5.isString(e)){if(!util$5.Long)return LongBits$2.fromNumber(parseInt(e,10));e=util$5.Long.fromString(e)}return e.low||e.high?new LongBits$2(e.low>>>0,e.high>>>0):zero},LongBits$2.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},LongBits$2.prototype.toLong=function(e){return util$5.Long?new util$5.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var charCodeAt=String.prototype.charCodeAt;LongBits$2.fromHash=function(e){return e===zeroHash?zero:new LongBits$2((charCodeAt.call(e,0)|charCodeAt.call(e,1)<<8|charCodeAt.call(e,2)<<16|charCodeAt.call(e,3)<<24)>>>0,(charCodeAt.call(e,4)|charCodeAt.call(e,5)<<8|charCodeAt.call(e,6)<<16|charCodeAt.call(e,7)<<24)>>>0)},LongBits$2.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits$2.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},LongBits$2.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},LongBits$2.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10},function(e){var t=minimal$1;function r(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function n(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=aspromise,t.base64=base64$1,t.EventEmitter=eventemitter,t.float=float,t.inquire=inquire_1,t.utf8=utf8$2,t.pool=pool_1,t.LongBits=longbits,t.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),t.global=t.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var n=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))},t.merge=r,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=n,t.ProtocolError=n("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}();var writer=Writer$1,util$4=minimal$1,BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function noop(){}function State(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(e,t,r){t[r]=255&e}function writeVarint32(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function VarintOp(e,t){this.len=e,this.next=void 0,this.val=t}function writeVarint64(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function writeFixed32(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(e){return new util$4.Array(e)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Op(e,t,r),this.len+=t,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new VarintOp((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},Writer$1.prototype.int32=function(e){return e<0?this._push(writeVarint64,10,LongBits$1.fromNumber(e)):this.uint32(e)},Writer$1.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Writer$1.prototype.uint64=function(e){var t=LongBits$1.from(e);return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(e){var t=LongBits$1.from(e).zzEncode();return this._push(writeVarint64,t.length(),t)},Writer$1.prototype.bool=function(e){return this._push(writeByte,1,e?1:0)},Writer$1.prototype.fixed32=function(e){return this._push(writeFixed32,4,e>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(e){var t=LongBits$1.from(e);return this._push(writeFixed32,4,t.lo)._push(writeFixed32,4,t.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(e){return this._push(util$4.float.writeFloatLE,4,e)},Writer$1.prototype.double=function(e){return this._push(util$4.float.writeDoubleLE,8,e)};var writeBytes=util$4.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};Writer$1.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(writeByte,1,0);if(util$4.isString(e)){var r=Writer$1.alloc(t=base64.length(e));base64.decode(e,r,0),e=r}return this.uint32(t)._push(writeBytes,t,e)},Writer$1.prototype.string=function(e){var t=utf8$1.length(e);return t?this.uint32(t)._push(utf8$1.write,t,e):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},Writer$1.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},Writer$1._configure=function(e){BufferWriter$1=e,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=minimal$1;function BufferWriter(){Writer.call(this)}function writeStringBuffer(e,t,r){e.length<40?util$3.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},BufferWriter.prototype.bytes=function(e){util$3.isString(e)&&(e=util$3._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(BufferWriter.writeBytesBuffer,t,e),this},BufferWriter.prototype.string=function(e){var t=util$3.Buffer.byteLength(e);return this.uint32(t),t&&this._push(writeStringBuffer,t,e),this},BufferWriter._configure();var reader=Reader$1,util$2=minimal$1,BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function Reader$1(e){this.buf=e,this.pos=0,this.len=e.length}var create_array="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Reader$1(e);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(e){return(Reader$1.create=function(e){return util$2.Buffer.isBuffer(e)?new BufferReader$1(e):create_array(e)})(e)}:create_array},value;function readLongVarint(){var e=new LongBits(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw indexOutOfRange(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function readFixed32_end(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var e=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},Reader$1.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw indexOutOfRange(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},Reader$1.prototype.string=function(){var e=this.bytes();return utf8.read(e,0,e.length)},Reader$1.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw indexOutOfRange(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},Reader$1._configure=function(e){BufferReader$1=e,Reader$1.create=create(),BufferReader$1._configure();var t=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[t](!1)},uint64:function(){return readLongVarint.call(this)[t](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[t](!1)},fixed64:function(){return readFixed64.call(this)[t](!0)},sfixed64:function(){return readFixed64.call(this)[t](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=minimal$1;function BufferReader(e){Reader.call(this,e)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},BufferReader._configure();var rpc={},service=Service,util=minimal$1,exports;function Service(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function e(t,r,n,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return util.asPromise(e,s,t,r,n,i);if(s.rpcImpl)try{return s.rpcImpl(t,r[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,r){if(e)return s.emit("error",e,t),o(e);if(null!==r){if(!(r instanceof n))try{r=n[s.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",r,t),o(null,r)}s.end(!0)}))}catch(e){return s.emit("error",e,t),void setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},Service.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},exports=rpc,exports.Service=service;var roots={};!function(e){var t=indexMinimal;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=writer,t.BufferWriter=writer_buffer,t.Reader=reader,t.BufferReader=reader_buffer,t.util=minimal$1,t.rpc=rpc,t.roots=roots,t.configure=r,r()}();var minimal=indexMinimal;const $Reader=minimal.Reader,$Writer=minimal.Writer,$util=minimal.util,$root=minimal.roots.default||(minimal.roots.default={});$root.DOMEvent=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.n=0,e.prototype.event="",e.prototype.isCheckout=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(0).uint32(e.n),null!=e.event&&Object.hasOwnProperty.call(e,"event")&&t.uint32(10).string(e.event),null!=e.isCheckout&&Object.hasOwnProperty.call(e,"isCheckout")&&t.uint32(16).bool(e.isCheckout),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.DOMEvent;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 0:n.n=e.uint32();break;case 1:n.event=e.string();break;case 2:n.isCheckout=e.bool();break;default:e.skipType(7&t)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.n&&e.hasOwnProperty("n")&&!$util.isInteger(e.n)?"n: integer expected":null!=e.event&&e.hasOwnProperty("event")&&!$util.isString(e.event)?"event: string expected":null!=e.isCheckout&&e.hasOwnProperty("isCheckout")&&"boolean"!=typeof e.isCheckout?"isCheckout: boolean expected":null},e.fromObject=function(e){if(e instanceof $root.DOMEvent)return e;let t=new $root.DOMEvent;return null!=e.n&&(t.n=e.n>>>0),null!=e.event&&(t.event=String(e.event)),null!=e.isCheckout&&(t.isCheckout=Boolean(e.isCheckout)),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.n=0,r.event="",r.isCheckout=!1),null!=e.n&&e.hasOwnProperty("n")&&(r.n=e.n),null!=e.event&&e.hasOwnProperty("event")&&(r.event=e.event),null!=e.isCheckout&&e.hasOwnProperty("isCheckout")&&(r.isCheckout=e.isCheckout),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})(),$root.ReportRequest=(()=>{function e(e){if(this.events=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.session=$util.newBuffer([]),e.prototype.events=$util.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(2).bytes(e.session),null!=e.events&&e.events.length)for(let r=0;r<e.events.length;++r)$root.DOMEvent.encode(e.events[r],t.uint32(10).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.ReportRequest;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 0:n.session=e.bytes();break;case 1:n.events&&n.events.length||(n.events=[]),n.events.push($root.DOMEvent.decode(e,e.uint32()));break;default:e.skipType(7&t)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.session&&e.hasOwnProperty("session")&&!(e.session&&"number"==typeof e.session.length||$util.isString(e.session)))return"session: buffer expected";if(null!=e.events&&e.hasOwnProperty("events")){if(!Array.isArray(e.events))return"events: array expected";for(let t=0;t<e.events.length;++t){let r=$root.DOMEvent.verify(e.events[t]);if(r)return"events."+r}}return null},e.fromObject=function(e){if(e instanceof $root.ReportRequest)return e;let t=new $root.ReportRequest;if(null!=e.session&&("string"==typeof e.session?$util.base64.decode(e.session,t.session=$util.newBuffer($util.base64.length(e.session)),0):e.session.length&&(t.session=e.session)),e.events){if(!Array.isArray(e.events))throw TypeError(".ReportRequest.events: array expected");t.events=[];for(let r=0;r<e.events.length;++r){if("object"!=typeof e.events[r])throw TypeError(".ReportRequest.events: object expected");t.events[r]=$root.DOMEvent.fromObject(e.events[r])}}return t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.events=[]),t.defaults&&(t.bytes===String?r.session="":(r.session=[],t.bytes!==Array&&(r.session=$util.newBuffer(r.session)))),null!=e.session&&e.hasOwnProperty("session")&&(r.session=t.bytes===String?$util.base64.encode(e.session,0,e.session.length):t.bytes===Array?Array.prototype.slice.call(e.session):e.session),e.events&&e.events.length){r.events=[];for(let n=0;n<e.events.length;++n)r.events[n]=$root.DOMEvent.toObject(e.events[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})(),$root.ReportResponse=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id="",e.prototype.session=$util.newBuffer([]),e.prototype.acknowledge=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.id&&Object.hasOwnProperty.call(e,"id")&&t.uint32(2).string(e.id),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(10).bytes(e.session),null!=e.acknowledge&&Object.hasOwnProperty.call(e,"acknowledge")&&t.uint32(16).uint32(e.acknowledge),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.ReportResponse;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 0:n.id=e.string();break;case 1:n.session=e.bytes();break;case 2:n.acknowledge=e.uint32();break;default:e.skipType(7&t)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.id&&e.hasOwnProperty("id")&&!$util.isString(e.id)?"id: string expected":null!=e.session&&e.hasOwnProperty("session")&&!(e.session&&"number"==typeof e.session.length||$util.isString(e.session))?"session: buffer expected":null!=e.acknowledge&&e.hasOwnProperty("acknowledge")&&!$util.isInteger(e.acknowledge)?"acknowledge: integer expected":null},e.fromObject=function(e){if(e instanceof $root.ReportResponse)return e;let t=new $root.ReportResponse;return null!=e.id&&(t.id=String(e.id)),null!=e.session&&("string"==typeof e.session?$util.base64.decode(e.session,t.session=$util.newBuffer($util.base64.length(e.session)),0):e.session.length&&(t.session=e.session)),null!=e.acknowledge&&(t.acknowledge=e.acknowledge>>>0),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.id="",t.bytes===String?r.session="":(r.session=[],t.bytes!==Array&&(r.session=$util.newBuffer(r.session))),r.acknowledge=0),null!=e.id&&e.hasOwnProperty("id")&&(r.id=e.id),null!=e.session&&e.hasOwnProperty("session")&&(r.session=t.bytes===String?$util.base64.encode(e.session,0,e.session.length):t.bytes===Array?Array.prototype.slice.call(e.session):e.session),null!=e.acknowledge&&e.hasOwnProperty("acknowledge")&&(r.acknowledge=e.acknowledge),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})();const ReviewRequest=$root.ReviewRequest=(()=>{function e(e){if(e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.n=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=$Writer.create()),null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(0).uint32(e.n),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.ReviewRequest;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 0:n.n=e.uint32();break;default:e.skipType(7&t)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.n&&e.hasOwnProperty("n")&&!$util.isInteger(e.n)?"n: integer expected":null},e.fromObject=function(e){if(e instanceof $root.ReviewRequest)return e;let t=new $root.ReviewRequest;return null!=e.n&&(t.n=e.n>>>0),t},e.toObject=function(e,t){t||(t={});let r={};return t.defaults&&(r.n=0),null!=e.n&&e.hasOwnProperty("n")&&(r.n=e.n),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})(),ReviewResponse=$root.ReviewResponse=(()=>{function e(e){if(this.event=[],e)for(let t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.event=$util.emptyArray,e.prototype.n=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=$Writer.create()),null!=e.event&&e.event.length)for(let r=0;r<e.event.length;++r)t.uint32(2).string(e.event[r]);return null!=e.n&&Object.hasOwnProperty.call(e,"n")&&t.uint32(8).uint32(e.n),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof $Reader||(e=$Reader.create(e));let r=void 0===t?e.len:e.pos+t,n=new $root.ReviewResponse;for(;e.pos<r;){let t=e.uint32();switch(t>>>3){case 0:n.event&&n.event.length||(n.event=[]),n.event.push(e.string());break;case 1:n.n=e.uint32();break;default:e.skipType(7&t)}}return n},e.decodeDelimited=function(e){return e instanceof $Reader||(e=new $Reader(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.event&&e.hasOwnProperty("event")){if(!Array.isArray(e.event))return"event: array expected";for(let t=0;t<e.event.length;++t)if(!$util.isString(e.event[t]))return"event: string[] expected"}return null!=e.n&&e.hasOwnProperty("n")&&!$util.isInteger(e.n)?"n: integer expected":null},e.fromObject=function(e){if(e instanceof $root.ReviewResponse)return e;let t=new $root.ReviewResponse;if(e.event){if(!Array.isArray(e.event))throw TypeError(".ReviewResponse.event: array expected");t.event=[];for(let r=0;r<e.event.length;++r)t.event[r]=String(e.event[r])}return null!=e.n&&(t.n=e.n>>>0),t},e.toObject=function(e,t){t||(t={});let r={};if((t.arrays||t.defaults)&&(r.event=[]),t.defaults&&(r.n=0),e.event&&e.event.length){r.event=[];for(let t=0;t<e.event.length;++t)r.event[t]=e.event[t]}return null!=e.n&&e.hasOwnProperty("n")&&(r.n=e.n),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,minimal.util.toJSONOptions)},e})();class ReviewStream{constructor(e,t){this.url=e,this.replayer=t,this.offset=0,this.connect(e)}async close(){!this._ws||this._ws.readyState!==WebSocket.OPEN&&this._ws.readyState!==WebSocket.CONNECTING||this._ws.close(4200)}async connect(e){return this.websocket?this.websocket:this.websocket=new Promise(((t,r)=>{try{const n=new WebSocket(e,["review"]);this._ws=n,n.binaryType="arraybuffer",n.addEventListener("open",(()=>{const e=ReviewRequest.encode({n:this.offset}).finish();n.send(e),t()})),n.addEventListener("error",(e=>{this.websocket=void 0,r(e),console.error(e)})),n.addEventListener("close",(e=>{this.websocket=void 0,r(e),console.error(e)})),n.addEventListener("message",(({data:e})=>{try{if(!(e instanceof ArrayBuffer))return;const t=ReviewResponse.decode(new Uint8Array(e));console.info(t);const{event:r,n:n}=t;if("number"==typeof n&&(this.offset=n),r){for(const e of r)this.replayer.addEvent(JSON.parse(e));this.replayer.startLive()}}catch(e){console.error(e),n.close(4400,e)}}))}catch(e){console.error(e),r(e)}}))}}new ReviewStream(`wss://${window.location.host}/api/activity/${window.location.hash.slice(1)}`,new Replayer([],{liveMode:!0}));
